{"version":3,"sources":["file:///E:/myCocosGame/cocosCreator/myYoumingArcher/assets/script/framework/effectManager.ts"],"names":["_decorator","Node","AnimationComponent","ParticleSystemComponent","Vec3","find","AnimationClip","isValid","director","PoolManager","ResourceUtil","WarningCircle","Reward","WarningStrip","WarningLine","ccclass","property","EffectManager","_ndParent","ndParent","ndEffectParent","getScene","addChild","instance","_instance","resetEffectState","ndEffect","aniName","arrParticle","getComponentsInChildren","length","forEach","element","stop","clear","arrAni","idx","defaultClip","name","aniState","getState","time","sample","loadAndPlayEffect","isLocal","ndTarget","effectPath","scale","pos","eulerAngles","isPlayAnimation","isPlayParticle","speed","isRecycle","recycleTime","callback","parent","loadEffectRes","then","prefab","getNode","setScale","setPosition","setWorldScale","setWorldPosition","setWorldRotationFromEuler","x","y","z","playEffect","maxDuration","duration","playAnimation","playParticle","setTimeout","putNode","destroy","animationName","isLoop","active","wrapMode","WrapMode","Loop","Normal","play","cb","once","EventType","FINISHED","console","warn","simulationSpeed","showRewardBounce","ndMonster","modelPath","rewardNum","loadModelRes","pf","i","ndReward","worldPosition","scriptReward","getComponent","init","showWarning","warningName","scriptParent","ndWarning","scriptWarning","showLightningChain","offsetPos","subtract","forward","normalize","negative"],"mappings":"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","sourcesContent":["import { _decorator, Node, Prefab, AnimationComponent, ParticleSystemComponent, Vec3, find, AnimationState, AnimationClip, isValid, director } from 'cc';\nimport { PoolManager } from './poolManager';\nimport { ResourceUtil } from './resourceUtil';\nimport { WarningCircle } from '../fight/warningSkill/warningCircle';\nimport { Reward } from '../fight/reward';\nimport { WarningStrip } from '../fight/warningSkill/warningStrip';\nimport { WarningLine } from '../fight/warningSkill/warningLine';\n\n/**\n * Predefined variables\n * Name = EffectManager\n * DateTime = Mon Dec 06 2021 16:13:38 GMT+0800 (中国标准时间)\n * Author = yveda\n * FileBasename = effectManager.ts\n * FileBasenameNoExtension = effectManager\n * URL = db://assets/script/framework/effectManager.ts\n * ManualUrl = https://docs.cocos.com/creator/3.3/manual/zh/\n *\n */\n\nconst { ccclass, property } = _decorator;\n//特效管理脚本\n@ccclass('EffectManager')\nexport class EffectManager {\n    private _ndParent: Node = null!;\n\n    private static _instance: EffectManager;\n\n    public get ndParent() {\n        if (!this._ndParent) {\n            let ndEffectParent = find(\"effectManager\") as Node;\n\n            if (ndEffectParent) {\n                this._ndParent = ndEffectParent;\n            } else {\n                // console.warn(\"请在场景里添加effectManager节点\");\n                this._ndParent = new Node(\"effectManager\");\n                director.getScene()?.addChild(this._ndParent);\n            }\n        }\n\n        return this._ndParent;\n    }\n\n    public static get instance() {\n        if (this._instance) {\n            return this._instance;\n        }\n\n        this._instance = new EffectManager();\n        return this._instance;\n    }\n    \n    /**\n     * 重置特效节点状态\n     * @param ndEffect 特效节点\n     * @param aniName 动画名字\n     * @returns \n     */\n    public resetEffectState (ndEffect: Node, aniName?: string) {\n        if (!isValid(ndEffect)) {\n            return;\n        }\n\n        let arrParticle: ParticleSystemComponent[] = ndEffect.getComponentsInChildren(ParticleSystemComponent);\n\n        if (arrParticle.length) {\n            arrParticle.forEach((element: ParticleSystemComponent) => {\n                element?.stop();\n                element?.clear();\n            })\n        }\n\n        let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n\n        if (arrAni.length) {\n            arrAni.forEach((element: AnimationComponent, idx: number) => {\n                \n                if (element.defaultClip && element.defaultClip.name) {\n                    let aniState: any = null!;\n\n                    if (aniName) {\n                        aniState = element.getState(aniName);\n                    }\n\n                    if (!aniState) {\n                        aniState = element.getState(element.defaultClip.name);\n                    }\n                    \n                    if (aniState) {\n                        aniState.stop();\n                        aniState.time = 0;\n                        aniState.sample();\n                    }\n                }\n            })\n        }\n    }\n\n    /**\n     * 加载特效节点并播放节点下面的动画、粒子\n     *\n     * @param {boolean} [isLocal=true] 是否将特效节点设置在本地坐标或者世界坐标下\n     * @param {Node} ndTarget 特效所在节点\n     * @param {string} effectPath 特效路径\n     * @param {number} [scale=1] 缩放大小\n     * @param {(Vec3 | null)} pos 坐标\n     * @param {(Vec3 | null)} eulerAngles 角度\n     * @param {boolean} [isPlayAnimation=true] 是否播放动画\n     * @param {boolean} [isPlayParticle=true] 是否播放特效\n     * @param {number} [speed=1] 播放速度\n     * @param {boolean} [isRecycle=false] 是否回收\n     * @param {number} [recycleTime=0] 回收时间\n     * @param {(Function | null)} callback 回调函数\n     * @returns\n     * @memberof EffectManager\n     */\n    public loadAndPlayEffect (isLocal: boolean = true, ndTarget: Node, effectPath: string, scale: number = 1, pos: Vec3 | null, eulerAngles: Vec3 | null, isPlayAnimation: boolean = true, isPlayParticle: boolean = true, speed: number = 1, isRecycle: boolean = false, recycleTime?: number | null, callback?: Function | null) {\n\n        //如果是本地坐标，父节点被回收的时候不播放\n        if (isLocal && (!ndTarget || !ndTarget.parent)) {\n            return;\n        }\n\n        ResourceUtil.loadEffectRes(effectPath).then((prefab: any) => {\n            let ndParent: Node = isLocal ? ndTarget : this.ndParent;\n            let ndEffect: Node = PoolManager.instance.getNode(prefab as Prefab, ndParent);\n\n            if (isLocal) {\n                ndEffect.setScale(scale, scale, scale);\n\n                if (pos) {\n                    ndEffect.setPosition(pos);\n                }\n\n                if (eulerAngles) {\n                    ndEffect.eulerAngles = eulerAngles;\n                }\n            } else {\n                ndEffect.setWorldScale(scale, scale, scale);\n\n                if (pos) {\n                    ndEffect.setWorldPosition(pos);\n                }\n\n                if (eulerAngles) {\n                    ndEffect.setWorldRotationFromEuler(eulerAngles.x, eulerAngles.y, eulerAngles.z);\n                }\n            }\n\n            this.playEffect(ndEffect, isPlayAnimation, isPlayParticle, speed, isRecycle, recycleTime, callback);\n        })\n    }\n\n    /**\n     * 播放节点下面的动画、粒子\n     *\n     * @param {Node} ndEffect 特效节点\n     * @param {boolean} [isPlayAnimation=true] 是否播放动画\n     * @param {boolean} [isPlayParticle=true] 是否播放特效\n     * @param {number} [speed=1] 播放速度\n     * @param {boolean} [isRecycle=false] 是否回收\n     * @param {number} [recycleTime=0] 回收时间\n     * @param {(Function | null)} callback 回调函数\n     * @returns\n     * @memberof EffectManager\n     */\n    public playEffect (ndEffect: Node, isPlayAnimation: boolean = true, isPlayParticle: boolean = true, speed: number = 1, isRecycle: boolean = false, recycleTime?: number | null, callback?: Function | null) {\n        //特效最长持续时间\n        let maxDuration: number = 0;\n\n        if (isPlayAnimation) {\n            let duration = this.playAnimation(ndEffect, speed, null, false, false, null, null);\n            maxDuration = duration > maxDuration ? duration : maxDuration;\n\n        }\n\n        if (isPlayParticle) {\n            let duration = this.playParticle(ndEffect, speed, false, null, null);\n            maxDuration = duration > maxDuration ? duration : maxDuration;\n        }\n\n        maxDuration = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n        if (callback || isRecycle) {\n            setTimeout(() => {\n                if (ndEffect.parent) {\n                    callback && callback();\n\n                    if (isRecycle) {\n                        PoolManager.instance.putNode(ndEffect);\n                    } else {\n                        ndEffect.destroy();\n                    }\n                }\n            }, maxDuration * 1000)\n        }\n    }\n\n    /**\n     * 播放节点上的默认动画特效\n     *\n     * @param {Node} ndEffect 特效节点\n     * @param {number} [speed=1] 动画播放速度\n     * @param {(string | null)} animationName 动画名称（当节点下只有一个动画组件，并指定播放动画的时候才会使用这个参数，否则都使用默认动画）\n     * @param {boolean} [isLoop=false] 是否循环播放\n     * @param {boolean} [isRecycle=false] 是否回收\n     * @param {(number | null)} recycleTime 回收时间,如果为null则使用maxDuration\n     * @param {(Function | null)} callback 回调函数\n     * @returns\n     * @memberof EffectManager\n     */\n    public playAnimation (ndEffect: Node, speed: number = 1, animationName: string | null,  isLoop: boolean = false, isRecycle: boolean = false, recycleTime?: number | null, callback?: Function | null) {\n        //动画播放最长时间\n        let maxDuration: number = 0;\n        let aniState: AnimationState = null!;\n\n        if (!ndEffect.active) {\n            ndEffect.active = true;\n        }\n\n        let arrAni: AnimationComponent[] = ndEffect.getComponentsInChildren(AnimationComponent);\n\n        if (arrAni.length) {\n            arrAni.forEach((element: AnimationComponent, idx: number) => {\n                let aniName = animationName ? animationName : element?.defaultClip?.name;\n\n                if (aniName) {\n                    aniState = element.getState(aniName);\n                    if (aniState) {\n                        aniState.time = 0;\n                        aniState.speed = speed;\n                        aniState.sample();\n\n                        let duration = aniState.duration;\n                        maxDuration = duration > maxDuration ? duration : maxDuration;\n\n                        if (isLoop) {\n                            aniState.wrapMode = AnimationClip.WrapMode.Loop;\n                        } else {\n                            aniState.wrapMode = AnimationClip.WrapMode.Normal;\n                        }\n\n                        element?.play(aniName);\n                    }\n                }\n            })\n\n            maxDuration = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n            let cb = ()=>{\n                if (ndEffect && ndEffect.parent) {\n                    callback && callback();\n\n                    if (isRecycle) {\n                        PoolManager.instance.putNode(ndEffect);\n                    }\n                }\n            }\n\n            if (callback || isRecycle) {\n                if (arrAni.length === 1) {\n                    arrAni[0].once(AnimationComponent.EventType.FINISHED, ()=>{\n                        cb();\n                    })\n                } else {\n                    setTimeout(() => {\n                        cb();\n                    }, maxDuration * 1000)\n                }\n            }\n\n            return maxDuration;\n        } else {\n            console.warn(`###${ndEffect.name}节点下没有动画特效`);\n            return 0;\n        }\n    }\n\n    /**\n     * 播放节点上的粒子特效\n     *\n     * @param {Node} ndEffect 特效节点\n     * @param {number} [speed=1] 粒子播放速度\n     * @param {boolean} [isRecycle=false] 是否需要回收特效节点\n     * @param {(number | null)} [recycleTime] 回收时间, 如果为null则使用maxDuration\n     * @param {(Function | null)} [callback] 回调函数\n     * @returns 返回播放完成所需秒数\n     * @memberof EffectManager\n     */\n    public playParticle (ndEffect: Node, speed: number = 1, isRecycle: boolean = false, recycleTime?: number | null, callback?: Function | null) {\n        //粒子播放最长时间\n        let maxDuration: number = 0;\n\n        if (!ndEffect.active) {\n            ndEffect.active = true;\n        }\n\n        let arrParticle: ParticleSystemComponent[] = ndEffect.getComponentsInChildren(ParticleSystemComponent);\n\n        if (arrParticle.length) {\n            arrParticle.forEach((element: ParticleSystemComponent) => {\n                element.simulationSpeed = speed;\n                element?.clear();\n                element?.stop();\n                element?.play();\n\n                let duration: number = element.duration;\n                maxDuration = duration > maxDuration ? duration : maxDuration;\n            })\n\n            //使用传进来的回收时间，否则设置为时长最长\n            maxDuration = recycleTime && recycleTime > 0 ? recycleTime : maxDuration;\n\n            if (callback || isRecycle) {\n                setTimeout(() => {\n                    if (ndEffect && ndEffect.parent) {\n                        callback && callback();\n\n                        if (isRecycle) {\n                            PoolManager.instance.putNode(ndEffect);\n                        }\n                    }\n                }, maxDuration * 1000)\n            }\n\n            return maxDuration;\n        } else {\n            console.warn(`###${ndEffect.name}节点下没有粒子特效`);\n            return 0;\n        }\n    }\n\n    /**\n     * 展示奖励(金币、爱心)弹跳\n     *\n     * @param {Node} ndMonster\n     * @param {string} modelPath\n     * @param {number} [rewardNum=1]\n     * @param {Function} [callback=()=>{}]\n     * @memberof EffectManager\n     */\n    public showRewardBounce (ndMonster: Node, modelPath: string, rewardNum: number = 1, callback: Function = ()=>{}) {\n        let time = rewardNum <= 10 ? 0.15 : 0.07;\n        ResourceUtil.loadModelRes(modelPath).then((pf: any)=>{\n            for (let i = 0; i < rewardNum; i++) {\n                let ndReward = PoolManager.instance.getNode(pf, this.ndParent) as Node;\n                ndReward.setWorldPosition(ndMonster.worldPosition.x, 1.65, ndMonster.worldPosition.z);\n                ndReward.active = false;\n                let scriptReward = ndReward.getComponent(Reward) as Reward;\n                scriptReward.init((i+1) * time, this.ndParent);\n            }\n\n            callback && callback();\n        });\n    }\n\n    /**\n     * 展示预警\n     *\n     * @param {string} warningName\n     * @param {number} scale\n     * @param {*} scriptParent\n     * @memberof EffectManager\n     */\n    public showWarning (warningName: string, scale: number, scriptParent: any, callback?: Function) {\n        ResourceUtil.loadEffectRes(`warning/${warningName}`).then((pf: any)=>{\n            let ndWarning = PoolManager.instance.getNode(pf, this.ndParent) as Node;\n\n            let scriptWarning: any = null; \n            if (warningName === \"warningLine\") {\n                scriptWarning = ndWarning.getComponent(WarningLine) as WarningLine;\n            } else if (warningName === \"warningStrip\") {\n                scriptWarning = ndWarning.getComponent(WarningStrip) as WarningStrip;\n            } else if (warningName === \"warningCircle\") {\n                scriptWarning = ndWarning.getComponent(WarningCircle) as WarningCircle;\n            }\n\n            scriptWarning.init(scale, scriptParent);\n\n            scriptParent.scriptWarning = scriptWarning;\n\n            callback && callback();\n        });\n    }\n\n    /**\n     * 展示闪电特效连接\n     *\n     * @param {Node} ndParent\n     * @param {Node} ndTarget\n     * @memberof EffectManager\n     */\n    public showLightningChain (ndParent: Node, ndTarget: Node) {\n        ResourceUtil.loadEffectRes(`lightningChain/lightningChain`).then((pf: any)=>{\n            let ndEffect = PoolManager.instance.getNode(pf, ndParent) as Node;\n            ndEffect.setWorldPosition(ndParent.worldPosition.x, 2.3, ndParent.worldPosition.z);\n\n            let offsetPos: Vec3 = new Vec3();\n\n            Vec3.subtract(offsetPos, ndTarget.worldPosition, ndParent.worldPosition);\n            ndEffect.setWorldScale(1, offsetPos.length(), 1);\n            ndEffect.forward = offsetPos.normalize().negative();\n            \n            setTimeout(()=>{\n                PoolManager.instance.putNode(ndEffect);\n            }, 100)\n        });\n    }\n}\n"]}