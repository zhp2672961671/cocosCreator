{"version":3,"sources":["file:///E:/myCocosGame/cocosCreator/myYoumingArcher/assets/script/fight/mapManager.ts"],"names":["_decorator","Component","Node","Vec3","Constant","Monster","Boss","LocalConfig","ResourceUtil","GameManager","ClientEvent","AudioManager","PoolManager","ccclass","property","MapManager","_dictModuleType","arrModuleData","_ndAn","_ndAnS","_warpGateWorPos_1","_warpGateWorPos_2","_ndWarpGate","_completeListener","_arrItem","_arrMap","onEnable","on","EVENT_TYPE","SHOW_WARP_GATE","_showWarpGate","HIDE_WARP_GATE","_hideWarpGate","onDisable","off","start","buildMap","mapName","progressCb","completeCb","instance","getTableArr","concat","cb","startsWith","active","isMapAnS","i","length","item","baseInfo","queryByID","ID","hasOwnProperty","type","push","arrPromise","_buildModel","Promise","all","then","console","log","catch","e","error","initWarpGate","loadModelRes","prefab","getNode","node","parent","resolve","reject","objItems","idx","layerInfo","modelPath","resName","p","parentName","ndParent","getChildByName","ndChild","position","split","angle","scale","setPosition","Number","eulerAngles","setScale","BASE_TYPE","MONSTER","scriptMonster","getComponent","init","arrMonster","BOSS","ndBoss","scriptBoss","NPC","existentNum","HEART","recycle","index","element","_recycleModel","removeAllChildren","ndItem","putNode","pf","playSound","SOUND","SHOW_WRAP_GATE","setWorldPosition"],"mappings":"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","sourcesContent":["import { Constant } from './../framework/constant';\nimport { Monster } from './monster';\nimport { Boss } from './boss';\nimport { _decorator, Component, Node, Vec3} from 'cc';\nimport { LocalConfig } from '../framework/localConfig';\nimport { ResourceUtil } from '../framework/resourceUtil';\nimport { GameManager } from './gameManager';\nimport { ClientEvent } from '../framework/clientEvent';\nimport { AudioManager } from '../framework/audioManager';\nimport { PoolManager } from '../framework/poolManager';\nconst { ccclass, property } = _decorator;\n//关卡模型管理脚本（怪物、爱心、障碍、npc）\n@ccclass('MapManager')\nexport class MapManager extends Component {\n    public _dictModuleType: any;//待加载的模块种类\n    public arrModuleData: any = {};//模块数据\n    public static isMapAnS: boolean = false;//是否是S型暗夜地图\n\n    private _ndAn: Node = null!;//默认暗夜地图节点\n    private _ndAnS: Node = null!;//S型暗夜地图节点\n    private _warpGateWorPos_1: Vec3 = new Vec3(16.414, 1.635, -0.804);//an地图传送门位置\n    private _warpGateWorPos_2: Vec3 = new Vec3(34.61, 1.635, -20);//anS地图传送门位置\n    private _ndWarpGate: Node = null!//传送门\n    private _completeListener: Function = null!;//加载完成回调\n    private _arrItem: any = [];//存放各项模块节点信息, 除了道路,在玩家后面一定距离则进行回收\n    private _arrMap: any = [];//当前关卡数据表\n\n    onEnable () {\n        ClientEvent.on(Constant.EVENT_TYPE.SHOW_WARP_GATE, this._showWarpGate, this);\n        ClientEvent.on(Constant.EVENT_TYPE.HIDE_WARP_GATE, this._hideWarpGate, this);\n    }\n\n    onDisable () {\n        ClientEvent.off(Constant.EVENT_TYPE.SHOW_WARP_GATE, this._showWarpGate, this);\n        ClientEvent.off(Constant.EVENT_TYPE.HIDE_WARP_GATE, this._hideWarpGate, this);\n    }\n\n    start () {\n        // [3]\n    }\n\n    public buildMap (mapName: string, progressCb: Function, completeCb: Function) {\n        this._completeListener = completeCb;\n        this._dictModuleType = {};\n\n        this._arrItem = [];\n        this._arrMap = [];\n\n        this._arrMap = LocalConfig.instance.getTableArr(mapName).concat();\n\n        let cb = ()=>{\n            if (mapName.startsWith(\"map1\")) {\n                this._ndAn && (this._ndAn.active = false);\n                this._ndAnS && (this._ndAnS.active = true);\n                MapManager.isMapAnS = true;\n            } else {\n                this._ndAn && (this._ndAn.active = true);\n                this._ndAnS && (this._ndAnS.active = false);\n                MapManager.isMapAnS = false;\n            }\n            \n            for (let i = this._arrMap.length - 1; i >= 0; i--) {\n                const item = this._arrMap[i];\n                let baseInfo = LocalConfig.instance.queryByID('base',item.ID);\n                \n                if (!this._dictModuleType.hasOwnProperty(baseInfo.type)) {\n                    this._dictModuleType[baseInfo.type] = [];\n                }\n    \n                this._dictModuleType[baseInfo.type].push(item);\n            }\n    \n            let arrPromise = [];\n    \n            for (const i in this._dictModuleType) {\n                let item = this._dictModuleType[i];\n                if (item.length) {\n                    arrPromise.push(this._buildModel(i));               \n                }\n            }\n    \n            Promise.all(arrPromise).then(()=>{\n                this._completeListener && this._completeListener();\n                console.log(`load ${mapName} over`);\n            }).catch((e)=>{\n                console.error(\"load item module err\", e);\n            })\n\n            if (!this._ndWarpGate) {\n                this.initWarpGate();\n            }\n        }\n\n        if (mapName.startsWith(\"map0\") && !this._ndAn) {\n            ResourceUtil.loadModelRes('scene/an').then((prefab: any)=>{\n                this._ndAn = PoolManager.instance.getNode(prefab, this.node.parent as Node);\n                cb();\n            })\n        } else if (mapName.startsWith(\"map1\") && !this._ndAnS) {\n            ResourceUtil.loadModelRes('scene/anS').then((prefab: any)=>{\n                this._ndAnS = PoolManager.instance.getNode(prefab, this.node.parent as Node);\n                cb();\n            })\n        } else {\n            cb();\n        }\n    }\n\n    private _buildModel (type: string) {\n        return new Promise((resolve, reject)=>{\n            let arrPromise =  [];\n\n            let objItems = this._dictModuleType[type];//同类型的信息\n            this._dictModuleType[type] = [];\n\n            for (let idx = 0; idx < objItems.length; idx++) {\n                //怪物在该层级别的配置信息\n                let layerInfo = objItems[idx];\n                //怪物的模块数据\n                let baseInfo = LocalConfig.instance.queryByID(\"base\", layerInfo.ID);\n                let modelPath = `${type}/${baseInfo.resName}`;\n                let p = ResourceUtil.loadModelRes(modelPath).then((prefab: any)=>{\n                    let parentName = type + 'Group';//先创建父节点\n                    let ndParent = this.node.getChildByName(parentName);\n    \n                    if (!ndParent) {\n                        ndParent = new Node(parentName);\n                        ndParent.parent = this.node;\n                    }\n\n                    let ndChild = PoolManager.instance.getNode(prefab, ndParent) as Node;\n                    let position = layerInfo.position ? layerInfo.position.split(',') : baseInfo.position.split(',');\n                    let angle = layerInfo.angle ? layerInfo.angle.split(',') : baseInfo.angle.split(',');\n                    let scale = layerInfo.scale ? layerInfo.scale.split(',') : baseInfo.scale.split(',');\n                    ndChild.setPosition(new Vec3(Number(position[0]), Number(position[1]), Number(position[2])));\n                    ndChild.eulerAngles = new Vec3(Number(angle[0]), Number(angle[1]), Number(angle[2]));\n                    ndChild.setScale(new Vec3(Number(scale[0]), Number(scale[1]), Number(scale[2])));\n\n                    //test\n                    if (baseInfo.type === Constant.BASE_TYPE.MONSTER) {\n                        let scriptMonster = ndChild?.getComponent(Monster) as Monster;\n                        scriptMonster.init(baseInfo, layerInfo);\n                        GameManager.arrMonster.push(ndChild);\n                    } else if (baseInfo.type === Constant.BASE_TYPE.BOSS) {\n                        GameManager.arrMonster.push(ndChild);\n                        GameManager.ndBoss = ndChild;\n                        GameManager.scriptBoss = ndChild?.getComponent(Boss) as Boss;\n                        GameManager.scriptBoss.init(baseInfo, layerInfo);\n                    } else if (baseInfo.type === Constant.BASE_TYPE.NPC) {\n                        GameManager.existentNum += 1;\n                    } else if (baseInfo.type === Constant.BASE_TYPE.HEART) {\n                        GameManager.existentNum += 1;\n                    }\n                    \n                    this._arrItem.push(ndChild);\n                })\n\n                arrPromise.push(p);\n            }  \n\n            Promise.all(arrPromise).then(()=>{\n                resolve(null);\n            }).catch((e)=>{\n                console.error(\"e\", e);\n            })\n        })\n    }\n\n    /**\n     * 回收模块\n     */\n    public recycle () {\n        for (let index = 0; index < this._arrItem.length; index++) {\n            const element = this._arrItem[index];\n            this._recycleModel(element);\n        }\n        \n        this.node.removeAllChildren();\n    }\n\n    /**\n     * 回收子模块\n     * @param ndItem \n     */\n    private _recycleModel (ndItem: Node) {\n        PoolManager.instance.putNode(ndItem);\n    }\n\n    /**\n     * 初始化传送门\n     *\n     * @private\n     * @memberof MapManager\n     */\n    private initWarpGate () {\n        ResourceUtil.loadModelRes(`warpGate/warpGate`).then((pf: any)=>{\n            this._ndWarpGate = PoolManager.instance.getNode(pf, this.node.parent as Node);\n            this._ndWarpGate.active = false;\n        })\n    }\n\n    /**\n     * 展示传送门\n     *\n     * @private\n     * @memberof GameManager\n     */\n     private _showWarpGate () {\n        AudioManager.instance.playSound(Constant.SOUND.SHOW_WRAP_GATE);\n\n        if (this._ndAn && this._ndAn.active) {\n            this._ndWarpGate.setWorldPosition(this._warpGateWorPos_1);\n        } else {\n            this._ndWarpGate.setWorldPosition(this._warpGateWorPos_2);\n        }\n\n        this._ndWarpGate.active = true;\n    }\n\n    /**\n     * 隐藏传送门\n     *\n     * @private\n     * @memberof GameManager\n     */\n    private _hideWarpGate () {\n        if (this._ndWarpGate) {\n            this._ndWarpGate.active = false;\n        }\n    }\n\n    // update (deltaTime: number) {\n    //     // [4]\n    // }\n}"]}