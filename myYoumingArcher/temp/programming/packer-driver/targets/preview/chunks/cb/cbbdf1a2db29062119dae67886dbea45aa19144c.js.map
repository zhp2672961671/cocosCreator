{"version":3,"sources":["file:///E:/myCocosGame/cocosCreator/myYoumingArcher/assets/script/framework/uiManager.ts"],"names":["_decorator","find","isValid","Vec3","ResourceUtil","Constant","ccclass","property","SHOW_STR_INTERVAL_TIME","v3_playerBloodOffsetPos","v3_playerBloodScale","v3_monsterBloodOffsetPos","v3_monsterBloodScale","UIManager","_dictSharedPanel","_dictLoading","_arrPopupDialog","_showTipsTime","instance","_instance","isDialogVisible","panelPath","hasOwnProperty","panel","active","parent","showDialog","args","cb","panelPriority","PRIORITY","NORMAL","idxSplit","lastIndexOf","scriptName","slice","script","getComponent","script2","charAt","toUpperCase","show","apply","createUI","err","node","isCloseBeforeShow","console","error","setSiblingIndex","hideDialog","callback","ani","close","pushToPopupSeq","param","popupDialog","isShow","push","_checkPopupSeq","insertToPopupSeq","index","splice","shiftFromPopupSeq","shift","length","first","showTips","content","type","targetPos","scale","str","String","next","_showTipsAni","now","Date","spareTime","setTimeout","showPlayerBloodBar","scriptParent","totalBlood","curBlood","offsetPos","showMonsterBloodBar","showBloodTips","bloodNum","offset"],"mappings":"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","sourcesContent":["// import { FightTip } from './../ui/common/fightTip';\r\nimport { _decorator, Node, find, isValid, Vec3 } from \"cc\";\r\nimport { ResourceUtil } from \"./resourceUtil\";\r\nimport { PoolManager } from \"./poolManager\";\r\n// import { tips } from \"../ui/common/tips\";\r\nimport { GameManager } from '../fight/gameManager';\r\n// import { PlayerBloodBar } from '../ui/fight/playerBloodBar';\r\n// import { MonsterBloodBar } from '../ui/fight/monsterBloodBar';\r\nimport { Constant } from './constant';\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet SHOW_STR_INTERVAL_TIME = 800;\r\nlet v3_playerBloodOffsetPos = new Vec3(-10, 100, 0);//血条距离玩家节点位置\r\nlet v3_playerBloodScale= new Vec3(1.5, 1.5, 1.5);//玩家血条缩放大小\r\nlet v3_monsterBloodOffsetPos = new Vec3(-10, 100, 0);//血条距离小怪节点位置\r\nlet v3_monsterBloodScale = new Vec3(1.5, 1.5, 1.5);//小怪血条缩放大小\r\n\r\n@ccclass(\"UIManager\")\r\nexport class UIManager {\r\n    private _dictSharedPanel: any = {}\r\n    private _dictLoading: any = {}\r\n    private _arrPopupDialog: any = []\r\n    private _showTipsTime: number = 0\r\n\r\n    private static _instance: UIManager;\r\n\r\n    public static get instance () {\r\n        if (this._instance) {\r\n            return this._instance;\r\n        }\r\n\r\n        this._instance = new UIManager();\r\n        return this._instance;\r\n    }\r\n\r\n    /**\r\n     * 检查当前界面是否正在展示\r\n     * @param panelPath\r\n     */\r\n    public isDialogVisible (panelPath:string) {\r\n        if (!this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            return false;\r\n        }\r\n\r\n        let panel = this._dictSharedPanel[panelPath];\r\n\r\n        return isValid(panel) && panel.active && isValid(panel.parent);\r\n    }\r\n\r\n\r\n    /**\r\n     * 显示单例界面\r\n     * @param {String} panelPath\r\n     * @param {Array} args\r\n     * @param {Function} cb 回调函数，创建完毕后回调\r\n     */\r\n    public showDialog(panelPath:string, args?: any, cb?: Function, panelPriority: number = Constant.PRIORITY.NORMAL) {\r\n        if (this._dictLoading[panelPath]) {\r\n            return;\r\n        }\r\n\r\n        let idxSplit = panelPath.lastIndexOf('/');\r\n        let scriptName = panelPath.slice(idxSplit + 1);\r\n\r\n        if (!args) {\r\n            args = [];\r\n        }\r\n\r\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            let panel = this._dictSharedPanel[panelPath];\r\n            if (isValid(panel)) {\r\n                panel.parent = find(\"Canvas\");\r\n                panel.active = true;\r\n                let script = panel.getComponent(scriptName);\r\n                let script2 = panel.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\r\n\r\n                if (script && script.show) {\r\n                    script.show.apply(script, args);\r\n                    cb && cb(script);\r\n                } else if (script2 && script2.show){\r\n                    script2.show.apply(script2, args);\r\n                    cb && cb(script2);\r\n                } else {\r\n                    throw `查找不到脚本文件${scriptName}`;\r\n                }\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._dictLoading[panelPath] = true;\r\n        ResourceUtil.createUI(panelPath, (err: any, node: Node) => {\r\n            //判断是否有可能在显示前已经被关掉了？\r\n            let isCloseBeforeShow = false;\r\n            if (!this._dictLoading[panelPath]) {\r\n                //已经被关掉\r\n                isCloseBeforeShow = true;\r\n            }\r\n\r\n            this._dictLoading[panelPath] = false;\r\n            if (err) {\r\n                console.error(err);\r\n                return;\r\n            }\r\n\r\n            // node.getComponent(UITransformComponent).priority = panelPriority;\r\n            node.setSiblingIndex(panelPriority);\r\n\r\n            this._dictSharedPanel[panelPath] = node;\r\n\r\n            let script: any = node.getComponent(scriptName);\r\n            let script2: any = node.getComponent(scriptName.charAt(0).toUpperCase() + scriptName.slice(1));\r\n            if (script && script.show) {\r\n                script.show.apply(script, args);\r\n                cb && cb(script);\r\n            } else if (script2 && script2.show){\r\n                script2.show.apply(script2, args);\r\n                cb && cb(script2);\r\n            } else {\r\n                throw `查找不到脚本文件${scriptName}`;\r\n            }\r\n\r\n            if (isCloseBeforeShow) {\r\n                //如果在显示前又被关闭，则直接触发关闭掉\r\n                this.hideDialog(panelPath);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 隐藏单例界面\r\n     * @param {String} panelPath\r\n     * @param {fn} callback\r\n     */\r\n    public hideDialog(panelPath: string, callback?: Function) {\r\n        if (this._dictSharedPanel.hasOwnProperty(panelPath)) {\r\n            let panel = this._dictSharedPanel[panelPath];\r\n            if (panel && isValid(panel)) {\r\n                let ani = panel.getComponent('animationUI');\r\n                if (ani) {\r\n                    ani.close(() => {\r\n                        panel.parent = null;\r\n                        if (callback && typeof callback === 'function') {\r\n                            callback();\r\n                        }\r\n                    });\r\n                } else {\r\n                    panel.parent = null;\r\n                    if (callback && typeof callback === 'function') {\r\n                        callback();\r\n                    }\r\n                }\r\n            } else if (callback && typeof callback === 'function') {\r\n                callback();\r\n            }\r\n        }\r\n\r\n        this._dictLoading[panelPath] = false;\r\n    }\r\n\r\n    /**\r\n     * 将弹窗加入弹出窗队列\r\n     * @param {string} panelPath\r\n     * @param {string} scriptName\r\n     * @param {*} param\r\n     */\r\n    public pushToPopupSeq(panelPath: string, scriptName: string, param: any) {\r\n        let popupDialog = {\r\n            panelPath: panelPath,\r\n            scriptName: scriptName,\r\n            param: param,\r\n            isShow: false\r\n        };\r\n\r\n        this._arrPopupDialog.push(popupDialog);\r\n\r\n        this._checkPopupSeq();\r\n    }\r\n\r\n    /**\r\n     * 将弹窗加入弹出窗队列\r\n     * @param {number} index\r\n     * @param {string} panelPath\r\n     * @param {string} scriptName\r\n     * @param {*} param\r\n     */\r\n    public insertToPopupSeq(index: number, panelPath: string, param: any) {\r\n        let popupDialog = {\r\n            panelPath: panelPath,\r\n            param: param,\r\n            isShow: false\r\n        };\r\n\r\n        this._arrPopupDialog.splice(index, 0, popupDialog);\r\n        //this._checkPopupSeq();\r\n    }\r\n\r\n    /**\r\n     * 将弹窗从弹出窗队列中移除\r\n     * @param {string} panelPath\r\n     */\r\n    public shiftFromPopupSeq(panelPath: string) {\r\n        this.hideDialog(panelPath, () => {\r\n            if (this._arrPopupDialog[0] && this._arrPopupDialog[0].panelPath === panelPath) {\r\n                this._arrPopupDialog.shift();\r\n                this._checkPopupSeq();\r\n            }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * 检查当前是否需要弹窗\r\n     */\r\n    private _checkPopupSeq() {\r\n        if (this._arrPopupDialog.length > 0) {\r\n            let first = this._arrPopupDialog[0];\r\n\r\n            if (!first.isShow) {\r\n                this.showDialog(first.panelPath, first.param);\r\n                this._arrPopupDialog[0].isShow = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示提示\r\n     * @param {String} content\r\n     * @param {Function} cb\r\n     */\r\n    public showTips (content: string | number, type: string = 'txt', targetPos: Vec3 = new Vec3(),  scale: number = 1, callback: Function = ()=>{}) {\r\n        let str = String(content);\r\n        let next = ()=>{\r\n            this._showTipsAni(str, type, targetPos, scale, callback);\r\n        }\r\n\r\n        var now = Date.now();\r\n        if (now - this._showTipsTime < SHOW_STR_INTERVAL_TIME && type !== 'gold' && type !== 'heart') {\r\n            var spareTime = SHOW_STR_INTERVAL_TIME - (now - this._showTipsTime);\r\n            setTimeout(() =>{\r\n                next();\r\n            }, spareTime);\r\n\r\n            this._showTipsTime = now + spareTime;\r\n        } else {\r\n            next();\r\n            this._showTipsTime = now;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 内部函数\r\n     * @param {String} content\r\n     * @param {Function} cb\r\n     */\r\n    private _showTipsAni (content: string, type: string, targetPos: Vec3, scale: number, callback?: Function) {\r\n        // ResourceUtil.getUIPrefabRes('common/tips', function (err: any, prefab: any) {\r\n        //     if (err) {\r\n        //         return;\r\n        //     }\r\n\r\n        //     let tipsNode = PoolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\r\n\r\n        //     let tipScript = tipsNode.getComponent(tips) as tips;\r\n        //     tipScript.show(content, type, targetPos, scale, callback);\r\n        // });\r\n    }\r\n\r\n    /**\r\n     * 展示玩家血条\r\n     *\r\n     * @param {*} scriptParent 条使用者绑定的节点，如玩家或者小怪\r\n     * @param {number} totalBlood 总血量\r\n     * @param {number} curBlood 当前血量\r\n     * @param {Function} [callback=()=>{}]\r\n     * @param {Vec3} [offsetPos=v3_playerBloodOffsetPos] 血条位置偏差\r\n     * @param {Vec3} [scale=v3_playerBloodScale] 血条缩放大小\r\n     * @memberof UIManager\r\n     */\r\n    public showPlayerBloodBar (scriptParent: any, totalBlood: number, curBlood: number, callback: Function = ()=>{}, offsetPos: Vec3 = v3_playerBloodOffsetPos, scale: Vec3 = v3_playerBloodScale) {\r\n        // ResourceUtil.getUIPrefabRes('fight/playerBloodBar', function (err: any, prefab: any) {\r\n        //     if (err) {\r\n        //         return;\r\n        //     }\r\n\r\n        //     let ndBloodBar = PoolManager.instance.getNode(prefab, find(\"Canvas\") as Node) as Node;\r\n        //     ndBloodBar.setSiblingIndex(0);\r\n        //     let scriptBloodBar = ndBloodBar.getComponent(PlayerBloodBar) as PlayerBloodBar;\r\n        //     scriptParent.scriptBloodBar = scriptBloodBar;\r\n        //     scriptBloodBar.show(scriptParent, totalBlood, curBlood, offsetPos, scale, callback);\r\n        // });\r\n    }\r\n\r\n    /**\r\n     * 展示小怪血条\r\n     *\r\n     * @param {*} scriptParent\r\n     * @param {number} totalBlood\r\n     * @param {number} bloodBarType\r\n     * @param {Function} [callback=()=>{}]\r\n     * @param {Vec3} [offsetPos=MONSTER_BLOOD_OFFSET_POS]\r\n     * @param {Vec3} [scale=MONSTER_BLOOD_SCALE]\r\n     * @memberof uiManager\r\n     */\r\n    public showMonsterBloodBar (scriptParent: any, totalBlood: number, callback: Function = ()=>{}, offsetPos: Vec3 = v3_monsterBloodOffsetPos, scale: Vec3 = v3_monsterBloodScale) {\r\n        // ResourceUtil.getUIPrefabRes('fight/monsterBloodBar', function (err: any, prefab: any) {\r\n        //     if (err) {\r\n        //         return;\r\n        //     }\r\n\r\n        //     let ndBloodBar = PoolManager.instance.getNode(prefab, find(\"Canvas\") as Node);\r\n        //     let scriptBloodBar = ndBloodBar.getComponent(MonsterBloodBar) as MonsterBloodBar;\r\n        //     scriptParent.scriptBloodBar = scriptBloodBar;\r\n        //     scriptBloodBar.show(scriptParent, totalBlood, offsetPos, scale, callback);\r\n        // });\r\n    }\r\n\r\n    /**\r\n     * 展示血量提示\r\n     */\r\n    public showBloodTips (scriptParent: any, type: number, bloodNum: number, offset: Vec3, callback?: Function) {\r\n        // ResourceUtil.getUIPrefabRes('common/fightTip',  (err: any, prefab: any)=> {\r\n        //     if (err) {\r\n        //         return;\r\n        //     }\r\n\r\n        //     let ndTip = <Node>PoolManager.instance.getNode(prefab,  <Node>find(\"Canvas\"));\r\n        //     let pos = GameManager.mainCamera?.convertToUINode(scriptParent.node.worldPosition, find('Canvas') as Node) as Vec3;\r\n        //     pos.add(offset);\r\n        //     ndTip.setPosition(pos);\r\n\r\n        //     let scriptTip = ndTip.getComponent(FightTip) as FightTip;\r\n        //     scriptTip.show(scriptParent, type, bloodNum, callback);\r\n        // });\r\n    }\r\n}\r\n\r\n"]}