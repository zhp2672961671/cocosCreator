{"version":3,"sources":["file:///E:/myCocosGame/cocosCreator/myYoumingArcher/assets/script/fight/reward.ts"],"names":["_decorator","Component","Vec3","Quat","clamp","tween","Enum","EffectManager","Util","Constant","ClientEvent","GameManager","ResourceUtil","AudioManager","PoolManager","REWARD_TYPE","GOLD","HEART","ccclass","property","Reward","type","displayOrder","isDropOver","_trialScale","_trialPos","_tweenBounce","_curQuat","_isAutoRotate","_isInhaling","_oriScale","_ndParent","_ndTrial","_endTargetPos","_midTargetPos","_stepTargetPos","_upSpeedY","_downSpeedY","_curSpeedY","_oriWorPos","_isArriveMinPos","_rewardWorPos","_playerWorPos","_nextWorPos","_offsetPos","_targetWorPos","_totalFlyTime","_curFlyTime","_raiseTimes","_bouncePos","_bounceScale","onEnable","on","EVENT_TYPE","INHALE_REWARD","_inhaleReward","onDisable","off","start","init","time","ndParent","node","setScale","getScale","set","getWorldPosition","x","z","scheduleOnce","show","loadEffectRes","then","pf","instance","getNode","active","setPosition","Math","random","y","add3f","playSound","SOUND","GOLD_DROP","_checkMonsterClearOver","ndTarget","getNearestMonster","arrReward","children","filter","ndChild","name","isAllDropOver","every","ndReward","scriptReward","getComponent","console","log","dispatchEvent","_closeTween","by","position","scale","easing","call","playParticle","stop","_checkInhaleOver","length","GOLD_COLLECT","SHOW_WARP_GATE","update","deltaTime","lerp","equals","fromEuler","rotate","scriptPlayer","worldPosition","subtract","offset","pow","percent","Number","toFixed","setWorldPosition","getTwoPosXZLength","putNode","rewardType","addGold","bloodNum","curHpLimit","addBlood"],"mappings":"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","sourcesContent":["import { EffectManager } from './../framework/effectManager';\nimport { Util } from './../framework/util';\nimport { Constant } from './../framework/constant';\nimport { _decorator, Component, Node, Vec3, Quat, clamp, tween, Enum } from 'cc';\nimport { ClientEvent } from '../framework/clientEvent';\nimport { GameManager } from './gameManager';\nimport { ResourceUtil } from '../framework/resourceUtil';\nimport { AudioManager } from '../framework/audioManager';\nimport { PoolManager } from '../framework/poolManager';\n//奖品(奖励)脚本：金币和爱心\n\n//奖励类型\nconst REWARD_TYPE = Enum ({\n    GOLD: 1,//金币\n    HEART: 2,//爱心\n})\nconst { ccclass, property } = _decorator;\n@ccclass('Reward')\nexport class Reward extends Component {\n    @property({\n        type: REWARD_TYPE,\n        displayOrder: 1\n    })\n    public rewardType: any = REWARD_TYPE.GOLD;\n    public isDropOver: boolean = false;//是否已经落在地上\n\n    private _trialScale = new Vec3(3, 3, 3);//拖尾缩放\n    private _trialPos: Vec3 = new Vec3(0, -0.1, 0);//拖尾位置\n    private _tweenBounce: any = null!;//tween\n    private _curQuat: Quat = new Quat();//旋转\n    private _isAutoRotate: boolean = false;//是否自动旋转\n    private _isInhaling: boolean = false;//是否正在吸入中\n    private _oriScale: Vec3 = null!;//原始缩放大小\n    private _ndParent: Node = null!;//父亲节点\n    private _ndTrial: Node = null!;//拖尾节点\n    private _endTargetPos:Vec3 = new Vec3();//最终目标位置\n    private _midTargetPos: Vec3 = new Vec3();//中间位置\n    private _stepTargetPos: Vec3 = new Vec3();//下一次的位置\n    private _upSpeedY: number = 0.2;//上升最大速度\n    private _downSpeedY: number = 0.2;//下降最大速度\n    private _curSpeedY: number = 0;//当前速度\n    private _oriWorPos: Vec3 = new Vec3();//初始奖品世界坐标\n    private _isArriveMinPos: boolean = false;//已经到达中间位置\n    private _rewardWorPos: Vec3 = new Vec3();//当前奖品世界坐标\n    private _playerWorPos: Vec3 = new Vec3();//目标(主角)位置\n    private _nextWorPos: Vec3 = new Vec3();//下一个位置\n    private _offsetPos: Vec3 = new Vec3();//奖品和玩家之间的向量差\n    private _targetWorPos: Vec3 = new Vec3();//\n    private _totalFlyTime: number = 0;//奖品总飞行时间\n    private _curFlyTime: number = 0;//奖品当前飞行时间\n    private _raiseTimes: number = 1;//\n    private _bouncePos: Vec3 = new Vec3(0, 0.618, 0);//回收缓动高度\n    private _bounceScale: Vec3 = new Vec3(0.2, 0.2, 0.2);//回收缓动缩放\n\n    onEnable () {\n        ClientEvent.on(Constant.EVENT_TYPE.INHALE_REWARD, this._inhaleReward, this);\n    }\n\n    onDisable () {\n        ClientEvent.off(Constant.EVENT_TYPE.INHALE_REWARD, this._inhaleReward, this);\n    }\n\n    start () {\n      \n    }\n\n    init (time: number, ndParent: Node) {\n        this._ndParent = ndParent;\n\n        if (this._oriScale) {\n            this.node.setScale(this._oriScale);\n        } else {\n            this._oriScale = this.node.getScale();\n        }\n\n        this._isAutoRotate = false;\n        this._isInhaling = false;\n        this._curSpeedY = this._upSpeedY;\n        this._oriWorPos.set(this.node.getWorldPosition().x, 1.65, this.node.getWorldPosition().z);\n        this._isArriveMinPos = false;\n        this.isDropOver = false;\n        this._totalFlyTime = 0;\n        this._curFlyTime = 0;\n        this._raiseTimes = 1;\n\n        //依次弹出奖品\n        this.scheduleOnce(()=>{\n            this.show();\n        }, time)\n\n        if (!this._ndTrial) {\n            ResourceUtil.loadEffectRes(\"trail/coinTrail\").then((pf: any)=>{\n                this._ndTrial = PoolManager.instance.getNode(pf, this.node);\n                this._ndTrial.active = false;    \n                this._ndTrial.setScale(this._trialScale);\n                this._ndTrial.setPosition(this._trialPos);\n            });\n        } else {\n            this._ndTrial.active = false;\n        }\n    }\n\n    show () {\n        this.node.active = true;\n        let x = Math.random() * 6 - 3;//-3~3\n        let y = 4;//最高的高度4~4.5;\n        let z = Math.random() * 6 - 3;//-3~3\n        this._endTargetPos = this._endTargetPos.set(this._oriWorPos).add3f(x, 0, z);\n        this._midTargetPos = this._midTargetPos.set(this._oriWorPos).add3f(x/2, y, z/2);\n\n        // console.log(\"终点位置\", this._endTargetPos, \"中间位置\", this._midTargetPos);\n\n        AudioManager.instance.playSound(Constant.SOUND.GOLD_DROP);  \n    }\n\n    /**\n     * 检查所有怪物是否已经击败，且奖品是否都全部掉落完毕\n     *\n     * @protected\n     * @memberof Reward\n     */\n    protected _checkMonsterClearOver () {\n        let ndTarget = GameManager.getNearestMonster();\n\n        if (!ndTarget) {\n            let arrReward = this._ndParent.children.filter((ndChild: Node)=>{\n                return ndChild.name === \"gold\" || ndChild.name === \"heart\";\n            })\n\n            let isAllDropOver = arrReward.every((ndReward: Node) => {\n                let scriptReward = ndReward.getComponent(Reward) as Reward;\n                return scriptReward.isDropOver === true;\n            });\n\n            if (isAllDropOver) {\n                console.log(\"###所有的奖品都已经掉落到地上了\");\n                ClientEvent.dispatchEvent(Constant.EVENT_TYPE.INHALE_REWARD);\n            }\n        }\n    }\n\n    /**\n     * 玩家吸入奖品\n     *\n     * @protected\n     * @memberof Reward\n     */\n    protected _inhaleReward () {\n        //先弹跳\n        this._closeTween();\n        this._tweenBounce = tween(this.node)\n        .by(0.3, {position: this._bouncePos, scale: this._bounceScale}, {easing: \"bounceInOut\"})\n        .call(()=>{\n            //播放粒子特效，不要勾选粒子的prewarm属性，免得出现概率性没有播放拖尾\n            this._ndTrial.active = true;\n\n            EffectManager.instance.playParticle(this._ndTrial);\n            \n            //再吸入\n            this._isInhaling = true;\n            \n        })\n        .start()\n    }\n\n    protected _closeTween () {\n        if (this._tweenBounce) {\n            this._tweenBounce.stop();\n            this._tweenBounce = null!;\n        }\n    }\n\n    /**\n     *  检查所有奖品是否吸收完毕\n     *\n     * @protected\n     * @memberof Reward\n     */\n    protected _checkInhaleOver () {\n        let arrReward = this._ndParent.children.filter((ndChild: Node)=>{\n            return ndChild.name === \"gold\" || ndChild.name === \"heart\";\n        })\n\n        if (!arrReward.length) {\n            console.log(\"###已吸入全部奖品\");\n            AudioManager.instance.playSound(Constant.SOUND.GOLD_COLLECT);\n            ClientEvent.dispatchEvent(Constant.EVENT_TYPE.SHOW_WARP_GATE);\n        }\n    }\n\n    update (deltaTime: number) {\n        //奖品上下弹跳\n        if (!this.isDropOver) {\n            this._rewardWorPos.set(this.node.position);\n            //先抬高\n            if (!this._isArriveMinPos) {\n                this._stepTargetPos = this._rewardWorPos.lerp(this._midTargetPos, 0.03);\n                this._curSpeedY = Util.lerp(this._upSpeedY, this._curSpeedY, 0.03);\n                this._nextWorPos = this._nextWorPos.set(this._stepTargetPos).add3f(0, this._curSpeedY, 0);\n                this._nextWorPos.y = clamp(this._nextWorPos.y, 0, this._midTargetPos.y);\n                this.node.setPosition(this._nextWorPos);\n    \n                // if (pos.equals(this._midTargetPos, 0.2)) {\n                if (this._nextWorPos.y >= this._midTargetPos.y) {\n                    this._isArriveMinPos = true;\n                    this._curSpeedY = 0;\n                    // console.log(\"到达中间位置\");\n                }\n            } else {//后降落\n                this._stepTargetPos = this._rewardWorPos.lerp(this._endTargetPos, 0.02);\n                this._curSpeedY = Util.lerp(this._downSpeedY, this._curSpeedY, 0.05);\n                // console.log(\"_upSpeedY\", this._curSpeedY);\n                this._nextWorPos = this._nextWorPos.set(this._stepTargetPos).add3f(0, -this._curSpeedY, 0);\n                this._nextWorPos.y = clamp(this._nextWorPos.y, this._endTargetPos.y, this._midTargetPos.y);\n                this.node.setPosition(this._nextWorPos);\n\n                if (this._nextWorPos.equals(this._endTargetPos, 0.3)) {\n                    this.isDropOver = true;\n                    // console.log(\"到达地板上\");\n                    this._isAutoRotate = true;\n                    this._checkMonsterClearOver();\n                }\n            }\n        }\n\n        //奖品落地后自动旋转\n        if (this._isAutoRotate) {\n            Quat.fromEuler(this._curQuat, 0, 120 * deltaTime, 0);\n            this.node.rotate(this._curQuat);\n        }\n\n        //奖品被玩家吸入\n        if (this._isInhaling) {\n            //位置靠近玩家\n            this._playerWorPos.set(GameManager.scriptPlayer.node.worldPosition);\n            this._rewardWorPos.set(this.node.worldPosition);\n            //向量差\n            Vec3.subtract(this._offsetPos, this._playerWorPos, this._rewardWorPos);\n\n            if (!this._totalFlyTime) {\n                this._totalFlyTime = this._offsetPos.length() / 2;\n            }\n\n            // 由慢到快\n            this._raiseTimes += deltaTime;\n            let offset = Math.pow(this._raiseTimes, 0.5) - 1;\n            this._curFlyTime += deltaTime + offset;\n            this._curFlyTime = this._curFlyTime >= this._totalFlyTime ? this._totalFlyTime : this._curFlyTime;\n\n            let percent = Number((this._curFlyTime / this._totalFlyTime).toFixed(2));\n            // console.log(\"percent\", percent);\n\n            this._targetWorPos.set(this._rewardWorPos.x + this._offsetPos.x * percent, this._playerWorPos.y, this._rewardWorPos.z + this._offsetPos.z * percent);\n            this.node.setWorldPosition(this._targetWorPos);\n\n            let length = Util.getTwoPosXZLength(this._targetWorPos.x, this._targetWorPos.z, this._playerWorPos.x, this._playerWorPos.z);\n            // if (this._targetWorPos.equals(this._playerWorPos, 0.1)) {\n            if (length <= 0.1) {\n                this._isInhaling = false;\n                this._ndTrial.active = false;\n                PoolManager.instance.putNode(this.node);\n\n                if (this.rewardType === REWARD_TYPE.GOLD) {\n                    GameManager.addGold();\n                } else if (this.rewardType === REWARD_TYPE.HEART) {\n                    //回复5%的血量\n                    let bloodNum = GameManager.scriptPlayer.curHpLimit * 0.05;\n                    GameManager.scriptPlayer.addBlood(bloodNum);\n                }\n\n                this._checkInhaleOver();\n                // console.log(\"吸收奖品\");\n            }\n        }\n    }\n}\n"]}