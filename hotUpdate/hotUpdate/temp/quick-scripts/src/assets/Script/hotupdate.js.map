{"version":3,"sources":["assets\\Script\\hotupdate.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Helloworld extends cc.Component {\n    /**显示更新信息 */\n    @property(cc.RichText)\n    label: cc.RichText = null;\n    /**当前版本信息 */\n    @property(cc.RichText)\n    versionStr: cc.RichText = null;\n    /**远程版本资源缓存路径 */\n    storagePath: string = \"\";\n    /**资源管理 */\n    am: jsb.AssetsManager = null;\n    /**更新状态 */\n    updating: boolean = false;\n    /**版本资源信息文件 */\n    @property(cc.Asset)\n    mainifestUrl: cc.Asset = null;\n    /**远程版本 */\n    private remoteVersion: string = \"\";\n    /**热更后的搜索路径 */\n    private HotUpdateSearchPaths: string = \"HotUpdateSearchPaths\";\n    /**远程资源缓存路径 */\n    private remotePath: string = \"remotePath\";\n    private curVersion: string = \"curVersion\";\n    start() {\n    }\n    onLoad() {\n        cc.sys.localStorage.removeItem(\"curVersion\")\n        this.versionStr.string = this.getCurVesion();\n        this.storagePath = this.getRootPath();\n        cc.log('远程版本缓存路径 : ' + this.storagePath);\n        this.am = new jsb.AssetsManager('', this.storagePath, this.versionCompareHanle);\n        this.am.setVerifyCallback(this.setVerifycb.bind(this));\n    }\n\n    setVerifycb(path, asset) {\n        let compressed = asset.compressed;\n        let expectedMD5 = asset.md5;\n        let relativePath = asset.path;\n        let size = asset.size;\n        cc.log(\"assetPath\", path)\n        cc.log(\"assetSize:\", size);\n        if (compressed) {\n            this.label.string = \"检查压缩 : \" + relativePath;\n            return true;\n        }\n        else {\n            this.label.string = \"检查压缩 : \" + relativePath + ' (' + expectedMD5 + ')';\n            return true;\n        }\n    }\n    /**比较版本 版本不同则更新*/\n    versionCompareHanle(versionA: string, versionB: string) {\n        console.log(`当前版本 :  ${versionA} , 远程版本 : ${versionB}`);\n        let vA = versionA.split('.');\n        let vB = versionB.split('.');\n        for (let i = 0; i < vA.length && i < vB.length; ++i) {\n            let a = parseInt(vA[i]);\n            let b = parseInt(vB[i]);\n            if (a === b) {\n                continue;\n            }\n            else {\n                return -1;\n            }\n        }\n        if (vB.length > vA.length) {\n            return -1;\n        }\n        return 0;\n    }\n    onClickTest(){\n        console.log(\"onClickTest=========================0\")\n    }\n    checkUpdate() {\n        console.log(\"checkUpdate=========================0\")\n        if (this.updating) {\n            return;\n        }\n        console.log(\"checkUpdate=========================1\")\n        let url = this.mainifestUrl.nativeUrl;\n        console.log(\"checkUpdate=========================2\")\n        cc.log(\"原包版本信息url:\", this.mainifestUrl.nativeUrl)\n        if (this.am.getState() === jsb.AssetsManager.State.UNINITED) {\n            if (cc.loader.md5Pipe) {\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            console.log(\"checkUpdate=========================3\")\n            this.am.loadLocalManifest(url);\n        }\n        if (!this.am.getLocalManifest() || !this.am.getLocalManifest().isLoaded()) {\n            this.label.string = '加载本地manifest文件失败';\n            console.log(\"checkUpdate=========================4\")\n            return;\n        }\n        this.am.setEventCallback(this.checkCb.bind(this));\n        console.log(\"checkUpdate=========================5\")\n        this.am.checkUpdate();\n        console.log(\"checkUpdate=========================6\")\n        this.updating = true;\n    }\n\n    checkCb(event) {\n        cc.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode()) {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.label.string = \"没有本地manifest文件，跳过热更.\";\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.label.string = \"下载远程manifest文件失败，跳过热更.\";\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.label.string = \"已经更新到远程最新版本.\";\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this.label.string = '发现新版本，请尝试热更';\n                break;\n            default:\n                return;\n        }\n        this.am.setEventCallback(null);\n        this.updating = false;\n    }\n\n    hotUpdate() {\n        if (this.am && !this.updating) {\n            console.log(\"hotUpdate==================\")\n            this.am.setEventCallback(this.updateCb.bind(this));\n            if (this.am.getState() === jsb.AssetsManager.State.UNINITED) {\n                console.log(\"hotUpdate==================1\")\n                let url = this.mainifestUrl.nativeUrl;\n                if (cc.loader.md5Pipe) {\n                    url = cc.loader.md5Pipe.transformURL(url);\n                }\n                this.am.loadLocalManifest(url);\n            }\n            this.am.update();\n            this.updating = true;\n        }\n    }\n\n    updateCb(event) {\n        cc.log(\"热更回调\")\n        var needRestart = false;\n        var failed = false;\n        let mm = event.getMessage();\n        if (mm) {\n            this.label.string = 'Updated file: ' + mm;\n        }\n        switch (event.getEventCode()) {\n\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.label.string = '没有本地manifest文件，跳过热更.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                console.log(\"当前下载文件数\", event.getDownloadedFiles())\n                console.log(\"总文件数\", event.getTotalFiles())\n                var msg = event.getMessage();\n                if (msg) {\n                    this.label.string = '更新的文件：: ' + msg;\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.label.string = '下载远程manifest文件失败，跳过热更.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.label.string = '已经更新到远程最新版本.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                this.label.string = '更新完成，即将重启游戏. ' + event.getMessage();\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.label.string = '更新失败. ' + event.getMessage();\n                this.updating = false;\n                // this._canRetry = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                this.label.string = 'Asset 更新错误: ' + event.getAssetId() + ', ' + event.getMessage();\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                this.label.string = event.getMessage();\n                break;\n            default:\n                break;\n        }\n\n\n        if (failed) {\n            this.updating = false;\n        }\n        /**重启游戏，并把缓存资源路径前置到搜索路径 */\n        if (needRestart) {\n            this.remoteVersion = this.getRemoteVersion();\n            cc.log(\"remoteversion:\", this.remoteVersion)\n            this.am.setEventCallback(null);\n            let searchPaths = jsb.fileUtils.getSearchPaths();\n            let newPaths = this.am.getLocalManifest().getSearchPaths();\n            Array.prototype.unshift(searchPaths, newPaths);\n            cc.sys.localStorage.setItem(this.HotUpdateSearchPaths, JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n            cc.sys.localStorage.setItem(this.curVersion, this.remoteVersion)\n            cc.game.restart();\n        }\n        this.versionStr.string = this.getCurVesion();\n    }\n\n    getRemoteVersion() {\n        let storagePath = this.getRootPath();\n        console.log(\"有下载的manifest文件\", storagePath);\n        let loadManifest = jsb.fileUtils.getStringFromFile(storagePath + '/project.manifest');\n        let manifestObject = JSON.parse(loadManifest);\n        return manifestObject.version;\n    }\n\n    /**获取缓存路径 */\n    getRootPath() {\n        return ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + this.remotePath);\n    }\n    /**\n     * 获取版本号\n     * 如果已存有版本号则直接返回，如果没有则在本地manifest文件中取版本号；\n     */\n    getCurVesion() {\n        let curversion = cc.sys.localStorage.getItem(this.curVersion);\n        cc.log(\"curversion\", curversion)\n        if (curversion) return curversion\n        let storagePath = this.getRootPath();\n        storagePath = this.mainifestUrl.nativeUrl;\n        if (storagePath) {\n            let loadManifest = jsb.fileUtils.getStringFromFile(storagePath);\n            let manifestObject = JSON.parse(loadManifest);\n            curversion = manifestObject.version;\n            console.log(\"当前版本号origin：\", curversion)\n        }\n        return curversion;\n    }\n\n\n    /**获取远程动态 url和版本号 ，版本号相同，直接进入游戏，否则重新设置project.manifest地址数据 然后更新 */\n    configUpdate() {\n        cc.sys.localStorage.removeItem(\"curVersion\")\n        let curVersion = this.getCurVesion();\n        let remoteVersion = \"1.0.0\"\n        // 大版本号\n        // curVersion第一个数字为主版本号，如果大版本大于本地版本则重新下载包（大版本更新部分）\n        let curMainId = 1\n        let bigVersion = 1\n        if (bigVersion > curMainId) {\n            let rootpath = this.getRootPath();\n            //删掉之前大版本的缓存路径\n            jsb.fileUtils.removeDirectory(rootpath);\n            //清除缓存的版本号 和 版本路径\n            cc.sys.localStorage.removeItem(\"curversion\");\n            let packageUrl = \"apk/api地址\";\n            cc.sys.openURL(packageUrl);\n            return;\n        }\n        //下面是 资源的更新检查（小版本更新部分）\n        let needcheck = this.versionCompareHanle(curVersion, remoteVersion);\n        // 本地版本和远程版本 相同直接跳转登陆, 这里 加判断是为了 防止每次都下载 manifest文件\n        if (needcheck == 0) {\n            console.log(\"小版本相同 进入登陆界面\")\n            return;\n        }\n        //拼接远程资源的下载地址\n        let scripturl = \"远程服务器地址\"\n        this._modifyAppLoadUrlForManifestFile(scripturl, this.mainifestUrl.nativeUrl);\n    }\n    /**\n    * 修改.manifest文件,如果有缓存则比较缓存的版本和应用包的版本，取较高者 热更，如果没有缓存则下载远程的版本文件 取版本号，这里统一修改地址为\n    * 远程地址，不管 如何变化 都是从最新的地址下载版本文件。这里远程\n    * @param {新的升级包地址} newAppHotUpdateUrl\n    * @param {本地project.manifest文件地址} localManifestPath\n    */\n    _modifyAppLoadUrlForManifestFile(newAppHotUpdateUrl, localManifestPath) {\n        let isWritten = false;\n        if (jsb.fileUtils.isFileExist(jsb.fileUtils.getWritablePath() + 'plane/project.manifest')) {\n            let storagePath = this.getRootPath();\n            console.log(\"有下载的manifest文件\", storagePath);\n            let loadManifest = jsb.fileUtils.getStringFromFile(storagePath + '/project.manifest');\n            let manifestObject = JSON.parse(loadManifest);\n            manifestObject.packageUrl = newAppHotUpdateUrl;\n            manifestObject.remoteManifestUrl = manifestObject.packageUrl + \"project.manifest\";\n            manifestObject.remoteVersionUrl = manifestObject.packageUrl + \"version.manifest\";\n            let afterString = JSON.stringify(manifestObject);\n            isWritten = jsb.fileUtils.writeStringToFile(afterString, storagePath + '/project.manifest');\n        } else {\n            /**\n             * 执行到这里说明App之前没有进行过热更，所以不存在热更的plane文件夹。\n             */\n\n            /**\n             * plane文件夹不存在的时候，我们就主动创建“plane”文件夹，并将打包时候的project.manifest文件中升级包地址修改后，存放到“plane”文件夹下面。\n             */\n            let initializedManifestPath = this.getRootPath();\n            if (!jsb.fileUtils.isDirectoryExist(initializedManifestPath)) {\n                jsb.fileUtils.createDirectory(initializedManifestPath);\n            }\n            //修改原始manifest文件\n            let originManifestPath = localManifestPath;\n            let originManifest = jsb.fileUtils.getStringFromFile(originManifestPath);\n            let originManifestObject = JSON.parse(originManifest);\n            originManifestObject.packageUrl = newAppHotUpdateUrl;\n            originManifestObject.remoteManifestUrl = originManifestObject.packageUrl + 'project.manifest';\n            originManifestObject.remoteVersionUrl = originManifestObject.packageUrl + 'version.manifest';\n\n            let afterString = JSON.stringify(originManifestObject);\n            isWritten = jsb.fileUtils.writeStringToFile(afterString, initializedManifestPath + '/project.manifest');\n        }\n        cc.log(\"Written Status : \", isWritten);\n        if (isWritten) {\n            this.checkUpdate();\n        }\n\n    }\n\n}\n"]}