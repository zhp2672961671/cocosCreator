{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/monsterSkill/tornado.ts"],"names":["_decorator","Component","Vec3","Node","AnimationComponent","GameManager","EffectManager","Util","Constant","AudioManager","PoolManager","ccclass","property","Tornado","skillInfo","baseInfo","_offsetPos","_oriWorPos","_targetSpeed","_curSpeed","_targetWorPos","_curWorPos","_disappearRange","start","init","scriptParent","scriptWarning","hideWarning","set","node","worldPosition","subtract","ndPlayer","normalize","negative","add","multiplyScalar","setWorldPosition","instance","playParticle","flySpeed","aniMove","getState","time","sample","play","playSound","SOUND","TORNADO","update","deltaTime","lerp","translate","NodeSpace","LOCAL","length","putNode"],"mappings":"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","sourcesContent":["import { GameManager } from './../gameManager';\nimport { _decorator, Component, Vec3, Node, AnimationComponent } from 'cc';\nimport { EffectManager } from '../../framework/effectManager';\nimport { Util } from '../../framework/util';\nimport { Constant } from '../../framework/constant';\nimport { AudioManager } from '../../framework/audioManager';\nimport { PoolManager } from '../../framework/poolManager';\nconst { ccclass, property } = _decorator;\n//台风S型脚本\n@ccclass('Tornado')\nexport class Tornado extends Component {\n    @property(AnimationComponent)\n    public aniMove: AnimationComponent = null!;\n\n    public skillInfo: any = null!;//技能信息\n    public baseInfo: any = null!;//基础信息\n\n    private _offsetPos: Vec3 = new Vec3();//当前坐标和玩家坐标的向量差\n    private _oriWorPos: Vec3 = new Vec3();//初始位置\n    private _targetSpeed: number = 0;//目标速度\n    private _curSpeed: number = 0;//当前速度\n    private _targetWorPos: Vec3 = new Vec3();//目标位置\n    private _curWorPos: Vec3 = new Vec3();//当前位置\n    private _disappearRange: number = 25;//箭节点超过玩家这个范围则隐藏\n\n    start () {\n        // [3]\n    }\n\n    public init (skillInfo: any, baseInfo: any, scriptParent?: any) {\n        this.skillInfo = skillInfo;\n        this.baseInfo = baseInfo;\n        scriptParent?.scriptWarning?.hideWarning();\n        this._oriWorPos.set(this.node.worldPosition);\n        this._curWorPos.set(this.node.worldPosition);\n        Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n        this._offsetPos.normalize().negative();\n        Vec3.add(this._curWorPos, this._curWorPos, this._offsetPos.multiplyScalar(2));\n        this.node.setWorldPosition(this._curWorPos);\n\n        EffectManager.instance.playParticle(this.node);\n        this._targetSpeed = skillInfo.flySpeed;\n        this._curSpeed = this._targetSpeed * 0.5;\n\n        this.aniMove.getState(\"tornado\").time = 0;\n        this.aniMove.getState(\"tornado\").sample();\n        this.aniMove.play();\n\n        AudioManager.instance.playSound(Constant.SOUND.TORNADO);  \n\n    }\n\n    update (deltaTime: number) {\n        if (GameManager.ndPlayer) {\n            //朝forward方向飞行\n            this._curSpeed = Util.lerp(this._targetSpeed, this._curSpeed, 0.25);\n            this._targetWorPos.set(0, 0, -deltaTime * this._curSpeed);\n            this.node.translate(this._targetWorPos, Node.NodeSpace.LOCAL);\n            this._curWorPos.set(this.node.worldPosition);\n\n            //超过玩家一定范围则隐藏\n            Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n            if (this._offsetPos && this._offsetPos.length() >= this._disappearRange) {\n                PoolManager.instance.putNode(this.node);\n            }\n        }\n    }\n}"]}