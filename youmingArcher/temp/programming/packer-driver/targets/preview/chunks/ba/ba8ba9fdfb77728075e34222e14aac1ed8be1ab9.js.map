{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/monsterSkill/dispersionSurround.ts"],"names":["_decorator","Component","Node","Vec3","Util","EffectManager","GameManager","AudioManager","Constant","PoolManager","ccclass","property","DispersionSurround","baseInfo","skillInfo","_curSpeed","_targetSpeed","_oriPos","_oriEulerAngles","_offsetPos","_curWorPos","_disappearRange","_targetWorPos","_oriScale","start","init","node","active","position","clone","eulerAngles","setPosition","set","flySpeed","instance","playParticle","playSound","SOUND","ENERGY_BALL","hide","parent","isAllHide","children","every","ndChild","putNode","update","deltaTime","ndPlayer","isGameOver","isGamePause","lerp","translate","NodeSpace","LOCAL","worldPosition","subtract","length"],"mappings":"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","sourcesContent":["import { Util } from './../../framework/util';\nimport { _decorator, Component, Node, Vec3 } from 'cc';\nimport { EffectManager } from '../../framework/effectManager';\nimport { GameManager } from '../gameManager';\nimport { AudioManager } from '../../framework/audioManager';\nimport { Constant } from '../../framework/constant';\nimport { PoolManager } from '../../framework/poolManager';\n//360度散射脚本: 挂载每个球上,而非父节点上\nconst { ccclass, property } = _decorator;\n@ccclass('DispersionSurround')\nexport class DispersionSurround extends Component {\n    public baseInfo: any = null!;//敌人基本信息\n    public skillInfo: any = null!;//技能信息\n\n    private _curSpeed: number = 0;//当前速度\n    private _targetSpeed: number = 0;//目标速度\n    private _oriPos: Vec3 = null!;//初始默认位置\n    private _oriEulerAngles: Vec3 = null!//初始默认角度\n    private _offsetPos: Vec3 = new Vec3();//和玩家之间的向量差\n    private _curWorPos: Vec3 = new Vec3();//当前节点世界坐标\n    private _disappearRange: number = 20;//箭节点超过玩家这个范围则隐藏\n    private _targetWorPos: Vec3 = new Vec3();//箭的下次目标位置\n    private _oriScale: Vec3 = new Vec3();//初始缩放大小\n\n    start () {\n        // [3]\n    }\n\n    /**\n    * 初始化 \n    */\n    public init (skillInfo: any, baseInfo: any) {\n        this.skillInfo = skillInfo;\n        this.baseInfo = baseInfo;\n        this.node.active = true;\n\n        if (!this._oriPos) {\n            this._oriPos = this.node.position.clone();\n        }\n\n        if (!this._oriEulerAngles) {\n            this._oriEulerAngles = this.node.eulerAngles.clone();\n        }\n        \n        this.node.setPosition(this._oriPos);\n        this.node.eulerAngles.set(this._oriEulerAngles);\n\n        this._targetSpeed = skillInfo.flySpeed;\n        this._curSpeed = skillInfo.flySpeed * 0.5;\n\n        EffectManager.instance.playParticle(this.node);\n\n        AudioManager.instance.playSound(Constant.SOUND.ENERGY_BALL);  \n    }\n\n    /**\n     * 击中玩家后隐藏\n     *\n     * @memberof Arrow\n     */\n    public hide () {\n        if (!this.node.parent) {\n            return;\n        }\n\n        this.node.active = false;\n\n        //如果dispersionSurround组里所有的球都隐藏了则回收整个dispersion预制体\n        let isAllHide = this.node.parent?.children.every((ndChild: Node)=>{\n            return ndChild.active === false;\n        })\n\n        if (isAllHide && this.node.parent) {\n            PoolManager.instance.putNode(this.node.parent);\n        }\n    }\n\n    update (deltaTime: number) {\n        if (!this.node.parent || !GameManager.ndPlayer || GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n\n        //朝forward方向飞行\n        this._curSpeed = Util.lerp(this._targetSpeed, this._curSpeed, 0.25);\n        this._targetWorPos.set(0, 0, -deltaTime * this._curSpeed);\n        this.node.translate(this._targetWorPos, Node.NodeSpace.LOCAL);\n\n        //超过玩家一定范围则隐藏\n        this._curWorPos.set(this.node.worldPosition);\n        Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n        if (this._offsetPos && this._offsetPos.length() >= this._disappearRange) {\n            this.hide();\n        }\n    }\n}"]}