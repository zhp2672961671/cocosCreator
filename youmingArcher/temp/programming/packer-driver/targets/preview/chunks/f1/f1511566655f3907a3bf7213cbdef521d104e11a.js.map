{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/main.ts"],"names":["_decorator","Component","game","Game","PhysicsSystem","profiler","sys","find","AudioManager","GameManager","Constant","PlayerData","StorageManager","LocalConfig","Util","SdkUtil","UIManager","ccclass","property","Main","_minLoadDuration","onEnable","onDisable","start","frameRate","instance","getGlobalData","GAME_FRAME","window","wx","checkIsLowPhone","setGlobalData","console","log","fixedTimeStep","isDebugOpen","showStats","hideStats","cocosAnalytics","init","appID","version","storeID","platform","toString","engine","loadGlobalCache","userId","generateRandomAccount","loadFromCache","playerInfo","createDate","createPlayerInfo","loadConfig","shareGame","GAME_NAME_CH","_loadFinish","setMusic","on","EVENT_HIDE","settings","hideTime","Date","now","saveAll","save","isFirstLoad","scheduleOnce","showDialog","destroy","LOGIN_TIME"],"mappings":"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","sourcesContent":["import { AudioManager } from './framework/audioManager';\nimport { GameManager } from './fight/gameManager';\nimport { Constant } from './framework/constant';\nimport { _decorator, Component, game, Game, PhysicsSystem, profiler, sys, find } from 'cc';\nimport { PlayerData } from './framework/playerData';\nimport { StorageManager } from './framework/storageManager';\nimport { LocalConfig } from './framework/localConfig';\nimport { Util } from './framework/util';\nimport { SdkUtil } from './framework/sdkUtil';\nimport { UIManager } from './framework/uiManager';\n//挂载到fight场景下的canvas节点\nconst { ccclass, property } = _decorator;\n\n@ccclass('Main')\nexport class Main extends Component {\n    private _minLoadDuration: number = 4;//加载开屏最小持续时间\n\n    onEnable () {\n    }\n\n    onDisable () {\n    }\n\n    start () {\n        let frameRate = StorageManager.instance.getGlobalData(\"frameRate\");\n        if (typeof frameRate !== \"number\") {\n            frameRate = Constant.GAME_FRAME;\n            //@ts-ignore\n            if (window.wx && Util.checkIsLowPhone()) {\n                frameRate = 30;\n            }\n\n            StorageManager.instance.setGlobalData(\"frameRate\", frameRate);\n        }\n\n        console.log(\"###frameRate\", frameRate);\n\n        game.frameRate = frameRate;\n        PhysicsSystem.instance.fixedTimeStep = 1 / frameRate;\n\n        let isDebugOpen = StorageManager.instance.getGlobalData(\"debug\") ?? false;\n        isDebugOpen === true ? profiler.showStats() : profiler.hideStats();\n\n        //@ts-ignore\n        if (window.cocosAnalytics) {\n            //@ts-ignore\n            window.cocosAnalytics.init({\n                appID: \"605630324\",              // 游戏ID\n                version: '1.0.0',           // 游戏/应用版本号\n                storeID: sys.platform.toString(),     // 分发渠道\n                engine: \"cocos\",            // 游戏引擎\n            });\n        }\n\n        PlayerData.instance.loadGlobalCache();\n        if (!PlayerData.instance.userId) {\n            PlayerData.instance.generateRandomAccount();\n            console.log(\"###生成随机userId\", PlayerData.instance.userId);\n        }\n\n        PlayerData.instance.loadFromCache();\n\n        if (!PlayerData.instance.playerInfo || !PlayerData.instance.playerInfo.createDate) {\n            PlayerData.instance.createPlayerInfo();\n        }\n\n        //加载CSV相关配置\n        LocalConfig.instance.loadConfig(()=>{\n            SdkUtil.shareGame(Constant.GAME_NAME_CH, \"\");\n            this._loadFinish();\n        })\n\n        //AudioManager.instance.init();\n        AudioManager.instance.setMusic(0.3);\n\n        //引导\n        //GuideManager.instance.start();\n\n        //加载子包\n        // SubPackageManager.instance.loadAllPackage();\n\n        //记录离线时间\n        game.on(Game.EVENT_HIDE, ()=>{\n            if (!PlayerData.instance.settings) {\n                PlayerData.instance.settings = {}\n            }\n\n            PlayerData.instance.settings.hideTime = Date.now();\n            PlayerData.instance.saveAll();\n            StorageManager.instance.save();\n        })\n    }\n\n    private _loadFinish () {\n        GameManager.isFirstLoad = true;\n\n        this.scheduleOnce(()=>{\n            UIManager.instance.showDialog(\"home/homePanel\", [], ()=>{\n                find(\"CanvasLogin\")?.destroy();\n                console.log(\"###开屏界面展示时长\", Date.now() - Constant.LOGIN_TIME);\n            });\n        }, this._minLoadDuration)\n    }\n}\n"]}