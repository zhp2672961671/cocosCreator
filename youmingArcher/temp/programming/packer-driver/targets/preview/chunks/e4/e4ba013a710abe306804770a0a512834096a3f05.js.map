{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/arrow.ts"],"names":["_decorator","Component","Node","Vec3","ParticleSystemComponent","math","BoxColliderComponent","Util","GameManager","ResourceUtil","Constant","Monster","PoolManager","ccclass","property","Arrow","isAutoRotate","isArrowLaunch","_ndBody","_curSpeed","_targetSpeed","_oriPos","_oriEulerAngles","_offsetPos","_curWorPos","_disappearRange","_isLoadEffectOver","_isNeedShowEffect","_targetWorPos","_curEulerAngles","_oriForward","_curForward","_releaseWorPos","_offsetPos_1","_offsetPos_2","_cross","_colliderCom","onLoad","node","getComponent","onEnable","on","_onTriggerEnterCb","onDisable","off","start","init","speed","releaseWorPos","isPreload","set","getChildByName","position","clone","eulerAngles","forward","active","setPosition","children","forEach","ndChild","name","startsWith","isHasIce","scriptPlayer","isArrowIce","isHasFire","isArrowFire","isHasLightning","isArrowLightning","_showTrail","effectName","ndTrail","loadEffectRes","then","pf","instance","getNode","recycleArrowGroup","parent","putNode","hideArrow","arrParticle","getComponentsInChildren","item","simulationSpeed","clear","stop","isAllArrowHide","every","ndArrow","playArrowLaunch","ndMonster","arrTargets","getNearbyMonster","length","ndTarget","x","worldPosition","z","radian","angle","toDegree","cross","y","event","isGameOver","isGameStart","otherCollider","getGroup","PHY_GROUP","OBSTACLE","scriptArrow","MONSTER","scriptMonster","isArrowPenetrate","playHit","changeDragonMat","update","deltaTime","ndPlayer","isGamePause","lerp","translate","NodeSpace","LOCAL","subtract"],"mappings":"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","sourcesContent":["import { Util } from './../framework/util';\nimport { GameManager } from './gameManager';\nimport { _decorator, Component, Node, Vec3, Quat, ParticleSystemComponent, math, ITriggerEvent, BoxColliderComponent } from 'cc';\nimport { ResourceUtil } from '../framework/resourceUtil';\nimport { Constant } from '../framework/constant';\nimport { Monster } from './monster';\nimport { PoolManager } from '../framework/poolManager';\n//单只弓箭脚本\nconst { ccclass, property } = _decorator;\n@ccclass('Arrow')\nexport class Arrow extends Component {\n    public isAutoRotate: boolean = true;//箭是否自动调整角度\n    public isArrowLaunch: boolean = false;//箭是否弹射\n    \n    private _ndBody: Node = null!;//放弓箭特效的节点\n    private _curSpeed: number = 0;//当前速度\n    private _targetSpeed: number = 0;//目标速度\n    private _oriPos: Vec3 = null!;//初始默认位置\n    private _oriEulerAngles: Vec3 = null!//初始默认角度\n    private _offsetPos: Vec3 = new Vec3();//和玩家之间的向量差\n    private _curWorPos: Vec3 = new Vec3();//当前节点世界坐标\n    private _disappearRange: number = 25;//箭节点超过玩家这个范围则隐藏\n    private _isLoadEffectOver: boolean = false;//是否已经加载完所有特效\n    private _isNeedShowEffect: boolean = false;//是否需要特效\n    private _targetWorPos: Vec3 = new Vec3();//箭的下次目标位置\n    private _curEulerAngles: Vec3 = new Vec3();//当前角度\n    private _oriForward: Vec3 = null!;//初始朝向\n    private _curForward: Vec3 = new Vec3();//当前朝向\n    private _releaseWorPos: Vec3 = new Vec3();//技能释放位置的世界坐标\n    private _offsetPos_1: Vec3 = new Vec3();//向量差\n    private _offsetPos_2: Vec3 = new Vec3();//向量差\n    private _cross: Vec3 = new Vec3();//两个向量叉乘\n    private _colliderCom: BoxColliderComponent = null!;//\n\n    onLoad () {\n        this._colliderCom = this.node.getComponent(BoxColliderComponent) as BoxColliderComponent;\n    }\n\n    onEnable () {\n        this._colliderCom.on('onTriggerEnter', this._onTriggerEnterCb, this);\n    }\n\n    onDisable () {\n        this._colliderCom.off('onTriggerEnter', this._onTriggerEnterCb, this);\n    }\n    \n    start () {\n        // [3]\n    }\n\n    /**\n    * 初始化 \n    */\n    public init (speed: number, releaseWorPos: Vec3, isPreload: boolean = false) {\n        this._releaseWorPos.set(releaseWorPos);\n\n        if (!this._ndBody) {\n            this._ndBody = this.node.getChildByName(\"body\") as Node;\n        }\n\n        this._isLoadEffectOver = false;\n        this._isNeedShowEffect = false;\n        this._disappearRange = isPreload ? 5 : 25;\n        \n        this.isArrowLaunch = false;\n\n        if (!this._oriPos) {\n            this._oriPos = this.node.position.clone();\n        }\n\n        if (!this._oriEulerAngles) {\n            this._oriEulerAngles = this.node.eulerAngles.clone();\n        }\n\n        if (!this._oriForward) {\n            this._oriForward = this.node.forward.clone();\n        }\n\n        this.node.active = false;\n        this.node.setPosition(this._oriPos);\n        this.node.eulerAngles = this._oriEulerAngles;\n        this._curForward.set(this._oriForward);\n\n        this._targetSpeed = speed;\n        this._curSpeed = speed * 0.5;\n\n        this._ndBody.children.forEach((ndChild: Node)=>{\n            if (ndChild.name.startsWith(\"arrow\") ) {\n                ndChild.active = false;\n            }\n        })\n\n        let isHasIce = GameManager.scriptPlayer.isArrowIce;\n        let isHasFire = GameManager.scriptPlayer.isArrowFire;\n        let isHasLightning = GameManager.scriptPlayer.isArrowLightning;\n\n        //根据玩家拥有的不同技能展示对应特效\n        if (isHasFire || isHasIce || isHasLightning) {\n            this._isNeedShowEffect = true;\n           \n            if (isHasFire && isHasIce && isHasLightning) {\n                this._showTrail(\"arrowAll\");\n            } else {\n                if ((isHasFire && isHasIce) || (isHasFire && isHasLightning) || (isHasIce && isHasLightning)) {\n                    if (isHasFire && isHasIce) {\n                        this._showTrail(\"arrowFireIce\");\n                    } else if (isHasLightning && isHasFire) {\n                        this._showTrail(\"arrowLightningFire\");\n                    } else if (isHasLightning && isHasIce) {\n                        this._showTrail(\"arrowLightningIce\");\n                    }\n                } else {\n                    if (isHasFire) {\n                        this._showTrail(\"arrowFire\");\n                    } else if (isHasIce) {\n                        this._showTrail(\"arrowIce\");\n                    } else if (isHasLightning) {\n                        this._showTrail(\"arrowLightning\");\n                    }\n                }\n            }\n        } else {\n            //不展示特效\n            this._ndBody.children.forEach((ndChild: Node)=>{\n                if (ndChild.name.startsWith(\"arrow\")) {\n                    ndChild.active = false;\n                }\n            })\n\n            this.node.active = true;\n        }\n    }\n\n    /**\n     * 展示箭的特效拖尾\n     *\n     * @private\n     * @param {string} effectName\n     * @memberof Arrow\n     */\n    private _showTrail (effectName: string) {\n        let ndTrail: Node | null = this._ndBody.getChildByName(effectName);\n        if (ndTrail) {\n            ndTrail.active = true;\n            this.node.active = true;\n            this._isLoadEffectOver = true;\n        } else {\n            ResourceUtil.loadEffectRes(`arrow/${effectName}`).then((pf: any)=>{\n                ndTrail = PoolManager.instance.getNode(pf, this._ndBody);\n                this.node.active = true;\n                this._isLoadEffectOver = true;\n            });\n        }\n    }\n\n    /**\n     *  回收弓箭组，在weapon/arrow下\n     *\n     * @memberof Arrow\n     */\n    public recycleArrowGroup () {\n        if (this.node.parent) {\n            PoolManager.instance.putNode(this.node.parent);\n        }\n    }\n\n    /**\n     * 击中目标,隐藏箭\n     *\n     * @memberof Arrow\n     */\n    public hideArrow () {\n        if (!this.node.parent) {\n            return;\n        }\n\n        //清除拖尾特效残留\n        let arrParticle:  ParticleSystemComponent[]= this._ndBody.getComponentsInChildren(ParticleSystemComponent);\n        arrParticle.forEach((item: ParticleSystemComponent)=>{\n            item.simulationSpeed = 1;\n            item?.clear();\n            item?.stop();\n        })\n\n        this.node.active = false;\n\n        //如果弓箭组里所有的箭都隐藏了则回收整个弓箭组\n        let isAllArrowHide = this.node.parent?.children.every((ndArrow: Node)=>{\n            return ndArrow.active === false;\n        })\n\n        if (isAllArrowHide) {\n            this.recycleArrowGroup();\n        }\n    }\n\n    /**\n     * 箭弹射给一定范围内的某个敌人\n     *\n     * @param {Node} ndMonster\n     * @memberof Arrow\n     */\n    public playArrowLaunch (ndMonster: Node) {\n        this.isArrowLaunch = true;\n\n        let arrTargets =  GameManager.getNearbyMonster(ndMonster);\n        \n        if (arrTargets.length) {\n            let ndTarget = arrTargets[0];\n            this._offsetPos_1.set(this._releaseWorPos.x - this.node.worldPosition.x, 0, this._releaseWorPos.z - this.node.worldPosition.z);\n            this._offsetPos_2.set(this.node.worldPosition.x - ndTarget.worldPosition.x, 0, this.node.worldPosition.z - ndTarget.worldPosition.z);\n            //两个向量之间弧度\n            let radian = Vec3.angle(this._offsetPos_1, this._offsetPos_2);\n            //角度\n            let angle = math.toDegree(radian);\n            //叉乘\n            Vec3.cross(this._cross, this._offsetPos_1, this._offsetPos_2);\n            //判断正反角度\n            if (this._cross.y > 0) {\n                this._curEulerAngles.y = angle;\n            } else {\n                this._curEulerAngles.y = -angle;\n            }\n\n            this.node.eulerAngles = this._curEulerAngles;\n        }\n    }\n\n    private _onTriggerEnterCb (event: ITriggerEvent) {\n        // this._hitTarget(event.otherCollider, event.selfCollider);\n        if (GameManager.isGameOver || !GameManager.isGameStart) {\n            return;\n        }\n\n        let otherCollider = event.otherCollider;\n        \n        if (otherCollider.getGroup() === Constant.PHY_GROUP.OBSTACLE) {\n            //箭碰到游戏中的障碍则回收\n            let scriptArrow = this.node.getComponent(Arrow) as Arrow;\n            scriptArrow.hideArrow();\n\n        } else if (otherCollider.getGroup() === Constant.PHY_GROUP.MONSTER) {\n            //箭碰到敌人\n            let ndMonster = otherCollider.node as Node;\n            let scriptMonster = ndMonster.getComponent(Monster) as Monster;\n            let scriptArrow = this.node.getComponent(Arrow) as Arrow;\n\n            //箭是否弹射\n            if (GameManager.scriptPlayer.isArrowLaunch) {\n                if (!scriptArrow.isArrowLaunch) {\n                    //第一次弹射\n                    scriptArrow.playArrowLaunch(ndMonster);\n                } else {\n                    //第二次直接隐藏\n                    scriptArrow.hideArrow();\n                }\n            } else if (GameManager.scriptPlayer.isArrowPenetrate) {\n                //箭穿透\n            } else {\n                scriptArrow.hideArrow();\n            }\n\n            scriptMonster.playHit(scriptArrow.isArrowLaunch);\n\n            //龙被射到龙改变颜色\n            if (ndMonster.name === \"dragon\") {\n                //@ts-ignore\n                \n                scriptMonster.changeDragonMat();\n            }\n        } \n    }\n\n    update (deltaTime: number) {\n        if (!this.node.parent || !GameManager.ndPlayer || GameManager.isGameOver || GameManager.isGamePause || (this._isNeedShowEffect && !this._isLoadEffectOver)) {\n            return;\n        }\n\n        //朝forward方向飞行\n        this._curSpeed = Util.lerp(this._targetSpeed, this._curSpeed, 0.25);\n        this._targetWorPos.set(0, 0, -deltaTime * this._curSpeed);\n        this.node.translate(this._targetWorPos, Node.NodeSpace.LOCAL);\n        this._curWorPos.set(this.node.worldPosition);\n\n        //超过玩家一定范围则隐藏\n        Vec3.subtract(this._offsetPos, this._curWorPos, GameManager.ndPlayer.worldPosition);\n        if (this._offsetPos && this._offsetPos.length() >= this._disappearRange) {\n            this.hideArrow();\n        }\n    }\n}"]}