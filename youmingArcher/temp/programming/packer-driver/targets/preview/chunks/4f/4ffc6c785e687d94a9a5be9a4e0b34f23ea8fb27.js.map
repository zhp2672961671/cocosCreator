{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/utils/camera.ts"],"names":["_decorator","Component","Node","systemEvent","SystemEvent","EventMouse","Vec3","macro","Quat","ccclass","property","Camera","lookButtonDown","_targetPos","_vertical","_horizontal","_speed","_rotateSpeed","_panButtonDown","_ratio","_translatePos","_mouseWheelPos","onLoad","start","node","position","onEnable","_addEvents","onDisable","_removeEvents","on","EventType","MOUSE_WHEEL","_onMouseWheel","MOUSE_MOVE","_onMouseMove","MOUSE_UP","_onMouseUp","MOUSE_DOWN","_onMouseDown","KEY_DOWN","_onKeyDown","KEY_UP","_onKeyUp","off","event","keyCode","KEY","w","s","a","d","getButton","BUTTON_LEFT","BUTTON_RIGHT","delta","getDelta","rotate","fromEuler","x","NodeSpace","WORLD","y","LOCAL","wheel","getScrollY","set","translate","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, systemEvent, SystemEvent, EventMouse, Vec3, macro, Quat, Touch, CameraComponent } from 'cc';\nconst { ccclass, property } = _decorator;\n//方便上下移动摄像机观察\n@ccclass('Camera')\nexport class Camera extends Component {\n    lookButtonDown: boolean = false;\n    /* class member could be defined like this */\n    // dummy = '';\n\n    /* use `property` decorator if your want the member to be serializable */\n    // @property\n    // serializableDummy = 0;\n\n    private _targetPos: Vec3 = new Vec3();\n    private _vertical: number = 0;\n    private _horizontal: number = 0;\n    private _speed: number = 50;\n    private _rotateSpeed: number = 0.1;\n    private _panButtonDown: boolean = false;\n    private _ratio: number = 0.2;//倍率\n    private _translatePos: Vec3 = new Vec3();\n    private _mouseWheelPos: Vec3 = new Vec3();\n\n    onLoad () {\n    }\n\n    start () {\n        this._targetPos = this.node.position;\n    }\n\n    onEnable () {\n\t\tthis._addEvents();\n\t}\n\n\tonDisable () {\n        this._removeEvents();\n    }\n    \n    private _addEvents () {\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_WHEEL, this._onMouseWheel, this);\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_MOVE, this._onMouseMove, this);\n\t\tsystemEvent.on(SystemEvent.EventType.MOUSE_UP, this._onMouseUp, this);\n        systemEvent.on(SystemEvent.EventType.MOUSE_DOWN, this._onMouseDown, this);\n        \n        systemEvent.on(SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        systemEvent.on(SystemEvent.EventType.KEY_UP, this._onKeyUp, this);\n\t}\n\n\tprivate _removeEvents () {\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_WHEEL, this._onMouseWheel, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_MOVE, this._onMouseMove, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_UP, this._onMouseUp, this);\n\t\tsystemEvent.off(SystemEvent.EventType.MOUSE_DOWN, this._onMouseDown, this);\n        \n        systemEvent.off(SystemEvent.EventType.KEY_DOWN, this._onKeyDown, this);\n        systemEvent.off(SystemEvent.EventType.KEY_UP, this._onKeyUp, this);\n    }\n\n    private _onKeyDown (event: any) {\n        if (event.keyCode == macro.KEY.w) {\n            this._vertical = -1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.s) {\n            this._vertical = 1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.a) {\n            this._horizontal = -1 * this._ratio;\n        } else if (event.keyCode == macro.KEY.d) {\n            this._horizontal = 1 * this._ratio;\n        }\n    }\n\n    private _onKeyUp (event: any) {\n        if (event.keyCode == macro.KEY.w && this._vertical < 0) {\n            this._vertical = 0;\n        } else if (event.keyCode == macro.KEY.s && this._vertical > 0) {\n            this._vertical = 0;\n        } else if (event.keyCode == macro.KEY.a && this._horizontal < 0) {\n            this._horizontal = 0;\n        } else if (event.keyCode == macro.KEY.d && this._horizontal > 0) {\n            this._horizontal = 0;\n        }\n    }\n    \n    private _onMouseDown (event: any) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                // this.lookButtonDown = true;\n                break;\n            // case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this._panButtonDown = true;\n                break;\n        }\n    };\n    \n    \n    private _onMouseUp (event: any) {\n        switch (event.getButton()) {\n            case EventMouse.BUTTON_LEFT:\n                // this.lookButtonDown = false;\n                break;\n            // case EventMouse.BUTTON_MIDDLE:\n            case EventMouse.BUTTON_RIGHT:\n                this._panButtonDown = false;\n                break;\n        }\n    };\n    \n    \n    private _onMouseMove (event: EventMouse) {\n        if (this._panButtonDown) {\n            let delta = event.getDelta();\n            // this.targetPos.x -= delta.x;\n            // this.targetPos.y -= delta.y;\n\n            this.node.rotate(Quat.fromEuler(new Quat(), 0, -delta.x * this._rotateSpeed, 0), Node.NodeSpace.WORLD);\n\n            this.node.rotate(Quat.fromEuler(new Quat(), delta.y * this._rotateSpeed, 0, 0), Node.NodeSpace.LOCAL);\n        }\n        \n    }\n    \n    \n    private _onMouseWheel (event: EventMouse) {\n\n        let wheel = 0;\n        if (event.getScrollY() > 0) {\n            wheel = -1 * this._ratio;\n        } else if (event.getScrollY() < 0) {\n            wheel = 1 * this._ratio;\n        }\n\n        this._mouseWheelPos.set(0, 0, wheel * 10);\n        this.node.translate(this._mouseWheelPos, Node.NodeSpace.LOCAL);\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n\n        this._translatePos.set(this._horizontal * deltaTime * this._speed, 0, this._vertical * deltaTime * this._speed);\n        this.node.translate(this._translatePos, Node.NodeSpace.LOCAL);\n    }\n}\n"]}