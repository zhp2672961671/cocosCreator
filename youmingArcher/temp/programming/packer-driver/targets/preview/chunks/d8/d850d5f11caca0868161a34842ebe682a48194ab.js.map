{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/playerModel.ts"],"names":["_decorator","Component","Node","Vec3","AnimationClip","SkeletalAnimationComponent","GameManager","Constant","AudioManager","ccclass","property","PlayerModel","looseEulerAngles","isAniPlaying","_aniType","_aniState","_stepIndex","isRunning","PLAYER_ANI_TYPE","RUN","isIdle","IDLE","isAttacking","ATTACK","start","init","hideArrow","onFrameAttackLoose","isGameOver","isGamePause","node","parent","eulerAngles","scriptPlayer","throwArrowToEnemy","ndArrow","active","onFrameRun","instance","playSound","SOUND","FOOT_STEP","onFrameAttackDraw","playAni","aniType","isLoop","callback","pos","aniComPlayer","getState","isPlaying","play","wrapMode","WrapMode","Loop","Normal","speed","gameSpeed","curAttackSpeed","hideRunSmoke","curMoveSpeed","playerBaseInfo","moveSpeed","playRunSmoke","once","EventType","FINISHED"],"mappings":"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","sourcesContent":["import { GameManager } from './gameManager';\nimport { _decorator, Component, Node, Vec3, SkeletalAnimationState, AnimationClip, SkeletalAnimationComponent } from 'cc';\nimport { Constant } from '../framework/constant';\nimport { AudioManager } from '../framework/audioManager';\nconst { ccclass, property } = _decorator;\n//玩家角色模型脚本\n@ccclass('PlayerModel')\nexport class PlayerModel extends Component {\n    @property(Node)\n    public ndSocketLoose: Node = null!//弓箭发射的节点\n\n    @property(Node)\n    public ndSocketHand: Node = null!//手节点\n\n    @property(Node)\n    public ndArrow: Node = null!;//攻击时候展示的弓箭\n\n    @property(SkeletalAnimationComponent)\n    public aniComPlayer: SkeletalAnimationComponent = null!;//动画播放组件\n\n    public looseEulerAngles: Vec3 = new Vec3();//射箭时的角度\n    public isAniPlaying: boolean = false;//当前动画是否正在播放\n\n    //是否正在跑\n    public get isRunning () {\n        return this._aniType === Constant.PLAYER_ANI_TYPE.RUN && this.isAniPlaying === true;\n    }\n\n    //是否待机\n    public get isIdle () {\n        return this._aniType === Constant.PLAYER_ANI_TYPE.IDLE && this.isAniPlaying === true;\n    }\n\n    //是否正在攻击\n    public get isAttacking () {\n        return this._aniType === Constant.PLAYER_ANI_TYPE.ATTACK && this.isAniPlaying === true;\n    } \n\n    private _aniType: string = \"\";//动画类型\n    private _aniState: SkeletalAnimationState = null!;//动画播放状态\n    private _stepIndex: number = 0;//脚步\n\n    start () {\n        // [3]\n    }\n\n    public init () {\n        this.hideArrow();\n    }\n\n    /**\n     * attack帧事件:箭射出去的时候触发\n     * @returns \n     */\n    public onFrameAttackLoose () {\n        if (GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n        \n        this.looseEulerAngles = this.node.parent?.eulerAngles as Vec3;\n        GameManager.scriptPlayer.throwArrowToEnemy();\n        this.ndArrow.active = false;\n\n        // console.log(\"looseEulerAngles\", this.looseEulerAngles);\n    }\n\n    /**\n     * run帧事件：脚落地的时候播放音效\n     *\n     * @memberof PlayerModel\n     */\n    public onFrameRun () {\n        this._stepIndex = this._stepIndex === 0 ? 1 : 0;\n        AudioManager.instance.playSound(Constant.SOUND.FOOT_STEP[this._stepIndex]);  \n    }\n\n    /**\n     * attack帧事件: 拉弓的时候触发\n     */\n    public onFrameAttackDraw () {\n        this.ndArrow.active = true;\n    }\n    \n    /**\n     * 隐藏模型手中默认的箭\n     */\n    public hideArrow () {\n        this.ndArrow.active = false;\n    }\n\n        /**\n     * 播放玩家动画\n     *\n     * @param {string} aniType 动画类型\n     * @param {boolean} [isLoop=false] 是否循环\n     * @param {Function} [callback] 回调函数\n     * @param {number} [callback] 调用播放动画的位置，方便用于测试\n     * @returns\n     * @memberof Player\n     */\n    public playAni (aniType: string, isLoop: boolean = false, callback?: Function, pos?: number) {\n        // console.log(\"playerAniType\", aniType, \"curAniType\", this.aniType, \"pos\", pos);\n        this._aniState = this.aniComPlayer?.getState(aniType) as SkeletalAnimationState;\n\n        if (this._aniState && this._aniState.isPlaying) {\n            return;\n        }\n\n        this._aniType = aniType;\n\n        if (this._aniType !== Constant.PLAYER_ANI_TYPE.ATTACK) {\n            this.hideArrow();\n        }\n\n        this.aniComPlayer?.play(aniType);\n        this.isAniPlaying = true;\n\n        if (this._aniState) {\n            if (isLoop) {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Loop;    \n            } else {\n                this._aniState.wrapMode = AnimationClip.WrapMode.Normal;    \n            }\n\n            switch (aniType) {\n                case Constant.PLAYER_ANI_TYPE.ATTACK:\n                    this._aniState.speed = GameManager.gameSpeed * GameManager.scriptPlayer.curAttackSpeed;\n                    GameManager.scriptPlayer.hideRunSmoke();\n                    break;\n                case Constant.PLAYER_ANI_TYPE.RUN:\n                    this._aniState.speed = GameManager.gameSpeed * (GameManager.scriptPlayer.curMoveSpeed / GameManager.scriptPlayer.playerBaseInfo.moveSpeed);\n                    GameManager.scriptPlayer.playRunSmoke(); \n                    break;\n                case Constant.PLAYER_ANI_TYPE.IDLE:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n                default:\n                    this._aniState.speed = GameManager.gameSpeed;\n                    break;\n            }\n        }\n\n        if (!isLoop) {\n            this.aniComPlayer.once(SkeletalAnimationComponent.EventType.FINISHED, ()=>{\n                this.isAniPlaying = false;\n                callback && callback();\n            })\n        }\n    }\n\n    // update (deltaTime: number) {\n    //     // [4]\n    // }\n}"]}