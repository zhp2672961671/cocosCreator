{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/ui/common/fightTip.ts"],"names":["LabelComponent","tween","Vec3","UITransformComponent","view","_decorator","Component","find","Constant","Util","GameManager","PoolManager","ccclass","property","FightTip","_tweenTip","_costTime","_arrDirection","objectToArray","BLOOD_TIP_DIRECTION","_isChangePos","_targetPos","_oriWorPos","_curWorPos","_oriScale","_oriAngle","_scale_1","_scale_2","start","show","scriptParent","tipType","bloodNum","callback","_closeTweenTip","node","eulerAngles","setScale","set","worldPosition","arrChildren","children","forEach","item","active","setSiblingIndex","PRIORITY","BLOOD_TIP","Math","round","txt","String","ndSub","FIGHT_TIP","ADD_BLOOD","getChildByName","REDUCE_BLOOD","CRITICAL_HIT","BLOOD_CRITICAL_TIP","lbHitNum","getComponent","string","pos","getPosition","width","height","abs","x","getCanvasSize","w","y","h","setPosition","getTargetPos","to","scale","easing","call","instance","putNode","dir","arr","concat","filter","bloodTipDirection","floor","random","length","LEFT_UP","MID_UP","RIGHT_UP","add","clone","stop","update","deltaTime","lerp","mainCamera","convertToUINode"],"mappings":"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","sourcesContent":["import { Constant } from './../../framework/constant';\nimport { LabelComponent, tween, Vec3, UITransformComponent, view, _decorator, Component, Node, find  } from 'cc';\nimport { Util } from '../../framework/util';\nimport { GameManager } from '../../fight/gameManager';\nimport { PoolManager } from '../../framework/poolManager';\n//战斗血量增减提示脚本\nconst { ccclass, property } = _decorator;\n\n@ccclass('FightTip')\nexport class FightTip extends Component {\n\n    private _tweenTip: any = null;//tween实例\n    private _costTime: number = 1.5;//缓动所需时间\n    private _arrDirection: any = Util.objectToArray(Constant.BLOOD_TIP_DIRECTION);//三个不同方向\n    private _isChangePos: boolean = false;//是否改变位置\n    private _targetPos: Vec3 = new Vec3(0, 200, 0);//目标位置\n    private _oriWorPos: Vec3 = new Vec3();//初始位置\n    private _curWorPos: Vec3  = new Vec3();//当前位置\n    private _oriScale: Vec3 = new Vec3(0.7, 0.7, 0.7);//初始缩放\n    private _oriAngle: Vec3 = new Vec3();//初始角度\n    private _scale_1: Vec3 = new Vec3(1, 1, 1);//最开始缩放\n    private _scale_2: Vec3 = new Vec3();//最终缩放\n\n    start () {\n        // Your initialization goes here.\n    }\n\n    /**\n     * 展示血量提示\n     *\n     * @param {*} scriptParent 关联的血条脚本\n     * @param {number} tipType 提示类型\n     * @param {string} bloodNum 数值\n     * @param {Function} [callback] 回调函数\n     * @memberof FightTip\n     */\n    public show (scriptParent: any, tipType: number, bloodNum: number, callback?: Function) {\n        this._closeTweenTip();\n        this.node.eulerAngles = this._oriAngle;\n        this.node.setScale(this._oriScale);\n        \n        this._isChangePos = false;\n        this._oriWorPos.set(scriptParent.node.worldPosition);\n\n        let arrChildren = this.node.children;\n        arrChildren.forEach((item)=>{\n            item.active = false;\n        })\n\n        // let UICom = this.node.getComponent(UITransformComponent) as UITransformComponent;\n        // UICom.priority = constant.PRIORITY.BLOOD_TIP;\n        \n        this.node.setSiblingIndex(Constant.PRIORITY.BLOOD_TIP);\n\n        bloodNum = Math.round(bloodNum);\n        let txt = String(bloodNum);\n\n        let ndSub: Node = null!;\n        if (tipType === Constant.FIGHT_TIP.ADD_BLOOD) {\n            ndSub = this.node.getChildByName(\"addBlood\") as Node;\n            txt = \"+\" + txt;\n        } else if (tipType === Constant.FIGHT_TIP.REDUCE_BLOOD) {\n            ndSub = this.node.getChildByName(\"reduceBlood\") as Node;\n        } else if (tipType === Constant.FIGHT_TIP.CRITICAL_HIT) {\n            ndSub = this.node.getChildByName(\"criticalHit\") as Node;\n            // UICom.priority = constant.PRIORITY.BLOOD_CRITICAL_TIP;\n            this.node.setSiblingIndex(Constant.PRIORITY.BLOOD_CRITICAL_TIP);\n        }\n\n        let lbHitNum = ndSub.getChildByName('num')?.getComponent(LabelComponent);\n        lbHitNum && (lbHitNum.string = txt);\n\n        ndSub.active = true;\n\n        let pos = this.node.getPosition();\n        let width:number = ndSub.getComponent(UITransformComponent)?.width!;\n        let height:number = ndSub.getComponent(UITransformComponent)?.height!;\n        if ((Math.abs(pos.x) + width / 2) > view.getCanvasSize().width / 2) {\n            let w = view.getCanvasSize().width / 2 - width / 2;\n            pos.x = pos.x > 0 ? w : -w;\n        }\n\n        if ((Math.abs(pos.y) + height / 2) > view.getCanvasSize().height / 2) {\n            let h = view.getCanvasSize().height / 2 - height / 2;\n            pos.y = pos.y > 0 ? h : -h;\n        }\n        this.node.setPosition(pos);\n\n        this.getTargetPos(scriptParent);\n\n        this._isChangePos = true;\n\n        this._tweenTip = tween(this.node)\n        .to(this._costTime * 0.4, {scale: this._scale_1}, {easing: 'smooth'})\n        .to(this._costTime * 0.2, {scale: this._scale_2}, {easing: \"backIn\"})\n        .call(()=>{\n            this._closeTweenTip();\n            PoolManager.instance.putNode(this.node);\n            callback && callback();\n            this._isChangePos = false;\n        })\n        .start();\n    }\n\n    /**\n     * 获取跟上次血量提示不一样方向的提示\n     */\n    private getTargetPos (scriptParent: any) {\n        let dir: number;\n        let arr = this._arrDirection.concat();\n        \n        arr = arr.filter((item: any)=>{\n            return item !== scriptParent.bloodTipDirection;\n        });\n\n        dir = arr[Math.floor(Math.random() * arr.length)];\n        switch (dir) {\n            case Constant.BLOOD_TIP_DIRECTION.LEFT_UP:\n                this._targetPos.set(-2, 5, 0);\n                break;\n            case Constant.BLOOD_TIP_DIRECTION.MID_UP:\n                this._targetPos.set(0, 4, 0);\n                break;\n            case Constant.BLOOD_TIP_DIRECTION.RIGHT_UP:\n                this._targetPos.set(2, 2, 0);\n                break;\n            default:\n                break;\n        }\n        \n        this._targetPos.add(scriptParent.node.worldPosition.clone());\n\n        scriptParent.bloodTipDirection = dir;\n    }\n\n    private _closeTweenTip () {\n        if (this._tweenTip) {\n            this._tweenTip.stop();\n            this._tweenTip = null;  \n        }\n    }\n\n    update (deltaTime: number) {\n        // Your update function goes here.\n\n        if (this._isChangePos) {\n            this._oriWorPos.lerp(this._targetPos, 0.05);\n            GameManager.mainCamera?.convertToUINode(this._oriWorPos, find('Canvas') as Node, this._curWorPos);\n            this.node.setPosition(this._curWorPos);\n        }\n    }\n\n}\n"]}