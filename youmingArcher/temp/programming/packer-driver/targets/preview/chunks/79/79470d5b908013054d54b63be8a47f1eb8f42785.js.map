{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/monsterSkill/fireBall.ts"],"names":["_decorator","Component","Vec3","AudioManager","Constant","EffectManager","PoolManager","ResourceUtil","GameManager","ccclass","property","FireBall","isPlayHitFireBall","groundWorPosY","scriptWarning","skillInfo","baseInfo","_isAutoRotate","_posStart","_posEnd","_posOffset","_totalFlyTime","_maxFlyHeight","_curFlyTime","_rotateCoolTime","_posNextTarget","_scriptParent","_targetPos","start","init","scriptParent","set","node","worldPosition","x","z","attackPos","subtract","length","flySpeed","children","forEach","ndChild","active","instance","playParticle","playSound","SOUND","FIRE_BALL","update","deltaTime","parent","ndPlayer","isGameOver","isGamePause","percent","Number","toFixed","height","Math","cos","PI","y","setWorldPosition","forward","normalize","position","hideWarning","loadEffectRes","then","prefab","ndEffect","getNode","gameSpeed","putNode"],"mappings":"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","sourcesContent":["import { _decorator, Component, Vec3, Node, Prefab } from 'cc';\nimport { AudioManager } from '../../framework/audioManager';\nimport { Constant } from '../../framework/constant';\nimport { EffectManager } from '../../framework/effectManager';\nimport { PoolManager } from '../../framework/poolManager';\nimport { ResourceUtil } from '../../framework/resourceUtil';\nimport { GameManager } from '../gameManager';\n//小火球脚本：抛物线，只有落地(播放爆炸)才有伤害, 所以碰撞器在hitFireBall1里面\nconst { ccclass, property } = _decorator;\n@ccclass('FireBall')\nexport class FireBall extends Component {\n    public isPlayHitFireBall: boolean = false;//是否播放火球\n    public groundWorPosY: number = 1.8;//地面相对世界原点高度\n    public scriptWarning: any = null!;//预警技能脚本\n    public skillInfo: any = null!;//技能信息\n    public baseInfo: any = null!;//敌人基本信息\n\n    private _isAutoRotate: boolean = true;//方向是否自动调整\n    private _posStart: Vec3 = new Vec3();//开始位置\n    private _posEnd: Vec3 = new Vec3();//结束位置\n    private _posOffset: Vec3 = new Vec3();//开始和结束位置差\n    private _totalFlyTime: number = 0;//小火球飞行时间\n    private _maxFlyHeight: number =0;//小火球最大飞行高度\n    private _curFlyTime: number = 0;//当前飞行时间\n    private _rotateCoolTime: number = 0;//每隔0.1秒调整角度\n    private _posNextTarget: Vec3 = new Vec3();//下次的目标位置\n    private _scriptParent: any = null!;//关联的怪物脚本\n    private _targetPos: Vec3 = new Vec3();//目标位置\n\n    start () {\n\n    }\n\n    /**\n    * 初始化 \n    */\n    public init (skillInfo: any, baseInfo: any, scriptParent?: any) {\n        this.skillInfo = skillInfo;\n        this.baseInfo = baseInfo;\n        this._scriptParent = scriptParent;\n        this._totalFlyTime = 0;\n        this._maxFlyHeight = 0;\n        this._curFlyTime = 0;\n        this._posStart.set(this.node.worldPosition.x, this.groundWorPosY, this.node.worldPosition.z);\n        this._posEnd.set(scriptParent.attackPos);\n        Vec3.subtract(this._posOffset, this._posEnd, this._posStart);\n        this._totalFlyTime = this._posOffset.length() / skillInfo.flySpeed;\n        this._maxFlyHeight = this._totalFlyTime * 3;//最大飞行高度跟飞行距离成正比     \n        this.isPlayHitFireBall = false;\n\n        this.node.children.forEach((ndChild: Node)=>{\n            ndChild.active = true;\n        })\n\n        EffectManager.instance.playParticle(this.node);\n\n        AudioManager.instance.playSound(Constant.SOUND.FIRE_BALL);\n    }\n\n    update (deltaTime: number) {\n        if (!this.node.parent || !GameManager.ndPlayer || GameManager.isGameOver || GameManager.isGamePause) {\n            return;\n        }\n\n        //向指定目标飞行\n        if (this._totalFlyTime > 0 && this.node.parent) {\n            if (this._curFlyTime <  this._totalFlyTime) {\n                this._curFlyTime += deltaTime;\n                this._curFlyTime = this._curFlyTime >= this._totalFlyTime ? this._totalFlyTime : this._curFlyTime;\n \n                let percent = Number((this._curFlyTime / this._totalFlyTime).toFixed(2));\n                //曲线飞行\n                let height = this._maxFlyHeight * Math.cos(percent * Math.PI - Math.PI/2);\n                this._targetPos.set(this._posStart.x + this._posOffset.x * percent, this._posStart.y + height, this._posStart.z + this._posOffset.z * percent);\n\n                this.node.setWorldPosition(this._targetPos);\n\n                if (this._isAutoRotate) {\n                    this._rotateCoolTime -= deltaTime;\n                    if (this._rotateCoolTime < 0) {\n                        this._rotateCoolTime = 0.1;\n                        percent = Number(((this._curFlyTime + deltaTime) / this._totalFlyTime).toFixed(2));\n                        if (percent < 1) {\n                            //曲线飞行\n                            height = this._maxFlyHeight * Math.cos(percent*Math.PI - Math.PI/2);\n                            this._posNextTarget.set(this._posStart.x + this._posOffset.x*percent, this._posStart.y + height,this._posStart.z + this._posOffset.z*percent)\n                            this.node.forward = this._posNextTarget.subtract(this._targetPos).normalize();\n                        }\n                    }\n                }\n\n                //小火球碰到地面\n                if (Number((this.node.position.y).toFixed(2)) <= this.groundWorPosY && !this.isPlayHitFireBall && this._curFlyTime > 0) {\n                    this.isPlayHitFireBall = true;\n\n                    //关闭预警\n                    this._scriptParent.scriptWarning?.hideWarning();   \n                    \n                    this.node.children.forEach((ndChild: Node)=>{\n                        ndChild.active = false;\n                    })\n\n                    //展示火焰爆炸\n                    ResourceUtil.loadEffectRes(\"hit/hitFireBall1\").then((prefab: any)=>{\n                        let ndEffect: Node = PoolManager.instance.getNode(prefab as Prefab, this.node) as Node;\n                        ndEffect.setWorldPosition(this.node.worldPosition);\n\n                        EffectManager.instance.playParticle(ndEffect, GameManager.gameSpeed, true, 1.1, ()=>{\n                            PoolManager.instance.putNode(this.node);\n                        });\n                    })\n                }\n            }\n        }\n    }\n}"]}