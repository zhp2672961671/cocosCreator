{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/ui/fight/bossBloodBar.ts"],"names":["_decorator","Component","UITransformComponent","tween","clamp","GameManager","ClientEvent","Constant","ccclass","property","BossBloodBar","_whiteBarHeight","_redBarHeight","_totalBlood","_curBlood","_maxBossWhiteBarWidth","_maxBossRedBarWidth","_isBloodEmpty","onEnable","on","EVENT_TYPE","REFRESH_BOSS_BLOOD","_refreshBossBlood","onDisable","off","start","show","scriptParent","totalBlood","isInit","node","active","ratio","UIComWhiteBar","setContentSize","UIComRedBar","num","to","width","call","scriptBoss","isDie"],"mappings":"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","sourcesContent":["import { GameManager } from './../../fight/gameManager';\nimport { ClientEvent } from './../../framework/clientEvent';\nimport { Constant } from './../../framework/constant';\nimport { _decorator, Component, UITransformComponent, tween, clamp } from 'cc';\n\nconst { ccclass, property } = _decorator;\n//boss血条脚本\n@ccclass('BossBloodBar')\nexport class BossBloodBar extends Component {\n    @property(UITransformComponent)\n    public UIComWhiteBar: UITransformComponent = null!;//白色进度条的UI组件\n\n    @property(UITransformComponent)\n    public UIComRedBar: UITransformComponent = null!;//血量进度条的UI组件\n\n    private _whiteBarHeight: number = 28;//白色进度条高度\n    private _redBarHeight: number = 28;//血量进度条高度\n    private _totalBlood: number = 0;//总的血量\n    private _curBlood: number = 0;//当前血量值\n    private _maxBossWhiteBarWidth: number = 560;//当前boss血条中白色进度条长度\n    private _maxBossRedBarWidth: number = 560;//当前boss血条中血量条长度\n    private _isBloodEmpty: boolean = false;//血条是否为空\n\n    onEnable () {\n        ClientEvent.on(Constant.EVENT_TYPE.REFRESH_BOSS_BLOOD, this._refreshBossBlood, this);\n    }\n\n    onDisable () {\n        ClientEvent.off(Constant.EVENT_TYPE.REFRESH_BOSS_BLOOD, this._refreshBossBlood, this);\n    }\n\n    start () {\n        // [3]\n    }\n\n    /**\n     * 展示血条\n     *\n     * @param {*} scriptParent 血条使用者绑定的节点，如玩家或者小怪\n     * @param {number} totalBlood 总血量\n     * @param {boolean} [isInit=true] 是否是初次展示，初次展示则显示完整血量，否则刷新的时候展示当前血量\n     * @memberof BloodBar\n     */\n    public show (scriptParent: any, totalBlood: number, isInit: boolean = true) {\n        this.node.active = true;\n\n        this._totalBlood = totalBlood;\n        this._isBloodEmpty = false;\n\n        if (isInit) {\n            this._curBlood = this._totalBlood;\n        }\n\n        //当前血量占全部的比例\n        let ratio = this._curBlood / this._totalBlood;\n        ratio = clamp(ratio, 0, 1);\n\n        //进度条宽度设置\n        this.UIComWhiteBar.setContentSize(ratio * this._maxBossWhiteBarWidth, this._whiteBarHeight);\n        this.UIComRedBar.setContentSize(ratio * this._maxBossRedBarWidth, this._redBarHeight);\n    }\n\n    /**\n     * 刷新boss血量\n     *\n     * @param {number} num 血量值\n     * @memberof BossBloodBar\n     */\n    private _refreshBossBlood (num: number) {\n        this._curBlood += num;\n\n        let ratio = this._curBlood / this._totalBlood;\n        ratio = ratio <= 0 ? 0 : ratio;\n\n        if (num < 0) {//减血\n            this.UIComRedBar.setContentSize(this._maxBossRedBarWidth * ratio, this._whiteBarHeight);\n    \n            if (!this._isBloodEmpty) {\n                this._isBloodEmpty = ratio <= 0;\n\n                tween(this.UIComWhiteBar)\n                .to(0.7, {width: this._maxBossWhiteBarWidth * ratio})\n                .call(()=>{\n                    if (ratio <= 0) {\n                        this.node.active = false;\n                        GameManager.scriptBoss.isDie = true;\n                    }\n                })\n                .start();\n            } \n        } \n    }\n}\n"]}