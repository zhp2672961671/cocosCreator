{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/colliderItem.ts"],"names":["_decorator","Component","Quat","MeshColliderComponent","BoxColliderComponent","CylinderColliderComponent","Enum","CapsuleColliderComponent","PlayerData","UIManager","GameManager","Constant","PoolManager","ccclass","property","COLLIDER_NAME","HEART_BIG","WARP_GATE","NPC_BUSINESS_MAN","NPC_WISE_MAN","ColliderItem","type","displayOrder","colliderCom","ani","_curHeartBigQuat","_timer","timer","obj","clearTimeout","onLoad","node","getComponent","console","error","onEnable","isTrigger","on","_onTriggerEnterCb","_onCollisionEnterCb","onDisable","off","start","init","event","_hitTarget","otherCollider","selfCollider","isGameOver","isGameStart","getGroup","PHY_GROUP","PLAYER","ndPlayer","colliderName","scriptPlayer","addBlood","instance","putNode","checkTriggerAll","playAction","action","PLAYER_ACTION","STOP_MOVE","scriptCharacterRigid","stopMove","active","isWin","isGamePause","scriptPlayerModel","playAni","PLAYER_ANI_TYPE","IDLE","isPlayerSkillAllUnlock","showTips","hideDialog","showDialog","PRIORITY","DIALOG","update","deltaTime","parent","fromEuler","rotate"],"mappings":"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","sourcesContent":["import { PlayerData } from './../framework/playerData';\nimport { UIManager } from './../framework/uiManager';\nimport { GameManager } from './gameManager';\nimport { _decorator, Component, Quat, MeshColliderComponent, Node, BoxColliderComponent, CylinderColliderComponent, ITriggerEvent, Enum, AnimationComponent, CapsuleColliderComponent, ICollisionEvent, math } from 'cc';\nimport { Constant } from '../framework/constant';\nimport { PoolManager } from '../framework/poolManager';\n//碰撞器脚本\n\nconst { ccclass, property } = _decorator;\n\nconst COLLIDER_NAME = Enum ({\n    HEART_BIG: 1,//大爱心, 玩家吃到后增加生命上限\n    WARP_GATE: 2,//传送门\n    NPC_BUSINESS_MAN: 3,//NPC商人\n    NPC_WISE_MAN: 4,//NPC智慧老头\n})\n\n//管理游戏中若干碰撞器\n@ccclass('ColliderItem')\nexport class ColliderItem extends Component {\n    @property({\n        type: COLLIDER_NAME,\n        displayOrder: 1\n    })\n    public colliderName: any = COLLIDER_NAME.HEART_BIG;//碰撞体类型名称\n\n    public colliderCom: any = null;\n    public ani: AnimationComponent = null!;\n    \n    public set timer (obj: any) {\n        if (this._timer) {\n            clearTimeout(this._timer);\n            this._timer = null;\n        }\n    }\n    \n    public static COLLIDER_NAME = COLLIDER_NAME;\n\n    private _curHeartBigQuat: Quat = new Quat();//爱心旋转\n    private _timer: any = null;//定时器\n\n    onLoad () {\n        this.colliderCom = this.node.getComponent(BoxColliderComponent) || this.node.getComponent(CylinderColliderComponent) || this.node.getComponent(CapsuleColliderComponent) || this.node.getComponent(MeshColliderComponent);\n\n        if (!this.colliderCom) {\n            console.error(\"this node does not have collider component\");\n        }\n    }\n\n    onEnable () {\n        if (this.colliderCom.isTrigger) {\n            this.colliderCom.on('onTriggerEnter', this._onTriggerEnterCb, this);\n        } else {\n            this.colliderCom.on('onCollisionEnter', this._onCollisionEnterCb, this);\n        }\n    }\n\n    onDisable () {\n        if (this.colliderCom.isTrigger) {\n            this.colliderCom.off('onTriggerEnter', this._onTriggerEnterCb, this);\n        } else {\n            this.colliderCom.off('onCollisionEnter', this._onCollisionEnterCb, this);\n        }\n    }\n\n    start () {\n    }\n\n    /**\n     * 初始化\n     */\n    public init () {\n\n    }   \n\n    private _onTriggerEnterCb (event: ITriggerEvent) {\n       this._hitTarget(event.otherCollider, event.selfCollider);\n    }\n\n    private _onCollisionEnterCb (event: ICollisionEvent) {\n       this._hitTarget(event.otherCollider, event.selfCollider);\n    }\n\n    private _hitTarget (otherCollider: any, selfCollider: any) {\n        if (GameManager.isGameOver || !GameManager.isGameStart) {\n            return;\n        }\n\n        // console.log(\"getGroup\", otherCollider.getGroup());\n\n        if (otherCollider.getGroup() == Constant.PHY_GROUP.PLAYER  && GameManager.ndPlayer) {\n            switch (this.colliderName) {\n                case COLLIDER_NAME.HEART_BIG:\n                    GameManager.scriptPlayer.addBlood(300);\n                    PoolManager.instance.putNode(this.node);\n                    GameManager.checkTriggerAll();\n                    break;\n                case COLLIDER_NAME.WARP_GATE:\n                    GameManager.scriptPlayer.playAction({action: Constant.PLAYER_ACTION.STOP_MOVE});\n                    GameManager.scriptPlayer.scriptCharacterRigid.stopMove();\n                    GameManager.ndPlayer.active = false;\n                    GameManager.isWin = true;\n                    break;\n                case COLLIDER_NAME.NPC_BUSINESS_MAN:\n                    GameManager.isGamePause = true;\n                    GameManager.scriptPlayer.scriptCharacterRigid.stopMove();\n                    GameManager.scriptPlayer.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n                    if (PlayerData.instance.isPlayerSkillAllUnlock) {\n                        //防错\n                        UIManager.instance.showTips(\"所有技能均已解锁\");\n                        PoolManager.instance.putNode(this.node);\n                        GameManager.isGamePause = false;\n                    } else {\n                        UIManager.instance.hideDialog(\"fight/fightPanel\");\n                        UIManager.instance.showDialog(\"shop/shopPanel\", [()=>{\n                            GameManager.isGamePause = false;\n                            PoolManager.instance.putNode(this.node);\n                        }], ()=>{}, Constant.PRIORITY.DIALOG);\n                    }\n\n                    GameManager.checkTriggerAll();\n                    break;\n                case COLLIDER_NAME.NPC_WISE_MAN:\n                    GameManager.isGamePause = true;\n                    GameManager.scriptPlayer.scriptCharacterRigid.stopMove();\n                    GameManager.scriptPlayer.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n                    if (PlayerData.instance.isPlayerSkillAllUnlock) {\n                        UIManager.instance.showTips(\"所有技能均已解锁\");\n                        PoolManager.instance.putNode(this.node);\n                        GameManager.isGamePause = false;\n                    } else {\n                        UIManager.instance.hideDialog(\"fight/fightPanel\");\n                        UIManager.instance.showDialog(\"skill/skillPanel\", [()=>{\n                            PoolManager.instance.putNode(this.node);\n                            GameManager.isGamePause = false;\n                        }], ()=>{}, Constant.PRIORITY.DIALOG);\n                    }\n\n                    GameManager.checkTriggerAll();\n                    break;\n            }\n        } \n    }\n\n    update (deltaTime: number) {\n        if (GameManager.isGameOver || !GameManager.ndPlayer || !this.node.parent) {\n            return;    \n        }\n\n        if (this.colliderName === COLLIDER_NAME.HEART_BIG) {\n            Quat.fromEuler(this._curHeartBigQuat, 0, 120 * deltaTime, 0);\n            this.node.rotate(this._curHeartBigQuat);\n        }\n    }\n}\n\n"]}