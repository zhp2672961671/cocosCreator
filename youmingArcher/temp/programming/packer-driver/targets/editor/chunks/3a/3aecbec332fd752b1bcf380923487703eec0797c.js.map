{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/ui/debug/debugPanel.ts"],"names":["_decorator","Component","Node","Prefab","game","PhysicsSystem","profiler","GameManager","DebugSkillItem","Constant","DebugLevelItem","PlayerData","UIManager","LocalConfig","StorageManager","ClientEvent","EffectManager","AudioManager","PoolManager","ccclass","property","DebugPanel","start","show","isGamePause","_initLevelView","_initSkillView","mapInfo","instance","getTableArr","ndContentLevel","children","forEach","item","active","itemInfo","idx","arr","ndChild","length","getNode","pbLevelItem","scriptDebugLevelItem","getComponent","init","playerSkillInfo","concat","filter","ID","PLAYER_SKILL","RECOVERY","ndContentPlayerSkill","pbSkillItem","onBtnCloseClick","playSound","SOUND","CLICK","hideDialog","onBtnClearStorageClick","playerInfo","history","settings","saveAll","jsonData","save","showTips","onToggleFrame30Click","setGlobalData","frameRate","fixedTimeStep","_showState","onToggleFrame60Click","onBtnClearPlayerSkillClick","arrSkill","savePlayerInfoToLocalCache","dispatchEvent","EVENT_TYPE","PARSE_PLAYER_SKILL","onBtnSelectAllPlayerSkillClick","GET_SKILL","push","loadAndPlayEffect","ndPlayer","gameSpeed","isDebugOpen","getGlobalData","showStats","hideStats"],"mappings":"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","sourcesContent":["import { GameManager } from './../../fight/gameManager';\nimport { DebugSkillItem } from './debugSkillItem';\nimport { Constant } from './../../framework/constant';\nimport { DebugLevelItem } from './debugLevelItem';\nimport { PlayerData } from './../../framework/playerData';\nimport { UIManager } from './../../framework/uiManager';\nimport { LocalConfig } from './../../framework/localConfig';\nimport { _decorator, Component, Node, Prefab, game, PhysicsSystem, profiler } from 'cc';\nimport { StorageManager } from '../../framework/storageManager';\nimport { ClientEvent } from '../../framework/clientEvent';\nimport { EffectManager } from '../../framework/effectManager';\nimport { AudioManager } from '../../framework/audioManager';\nimport { PoolManager } from '../../framework/poolManager';\nconst { ccclass, property } = _decorator;\n//调试界面脚本\n@ccclass('DebugPanel')\nexport class DebugPanel extends Component {\n    @property(Node)\n    public ndContentLevel: Node = null!;//等级父节点\n\n    @property(Node)\n    public ndContentPlayerSkill: Node = null!;//技能父节点\n\n    @property(Prefab)\n    public pbLevelItem: Prefab = null!;//等级预制体\n\n    @property(Prefab)\n    public pbSkillItem: Prefab = null!;//技能预制体\n\n    start () {\n        // [3]\n    }\n\n    /**\n     * 展示界面\n     */\n    public show () {\n        GameManager.isGamePause = true;\n\n        this._initLevelView();\n        this._initSkillView();\n    }\n\n    /**\n     * 初始化关卡列表\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _initLevelView () {\n        let mapInfo = LocalConfig.instance.getTableArr(\"checkpoint\");\n\n        this.ndContentLevel.children.forEach((item: Node)=>{\n            item.active = false;\n        })\n        \n        mapInfo.forEach((itemInfo: any, idx: number, arr: any) => {\n            let ndChild: Node = null!;\n\n            if (idx < this.ndContentLevel.children.length) {\n                ndChild = this.ndContentLevel.children[idx];\n            } else {\n                ndChild = PoolManager.instance.getNode(this.pbLevelItem, this.ndContentLevel);\n            }\n\n            ndChild.active = true;\n            let scriptDebugLevelItem = ndChild.getComponent(DebugLevelItem) as DebugLevelItem;\n            scriptDebugLevelItem.init(itemInfo);\n        });\n    }\n\n    /**\n     * 初始化玩家技能列表\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _initSkillView () {\n        let playerSkillInfo = LocalConfig.instance.getTableArr(\"playerSkill\");\n        //策划说回复生命的不出现在技能列表里面\n        playerSkillInfo = playerSkillInfo.concat().filter((item: any)=>{\n            return item.ID !== Constant.PLAYER_SKILL.RECOVERY;\n        })\n\n        this.ndContentPlayerSkill.children.forEach((item: Node)=>{\n            item.active = false;\n        })\n        \n        playerSkillInfo.forEach((itemInfo: any, idx: number, arr: any) => {\n            let ndChild: Node = null!;\n\n            if (idx < this.ndContentPlayerSkill.children.length) {\n                ndChild = this.ndContentPlayerSkill.children[idx];\n            } else {\n                ndChild = PoolManager.instance.getNode(this.pbSkillItem, this.ndContentPlayerSkill);\n            }\n\n            ndChild.active = true;\n            let scriptDebugLevelItem = ndChild.getComponent(DebugSkillItem) as DebugSkillItem;            \n            scriptDebugLevelItem.init(itemInfo);\n        });        \n    }\n\n    /**\n     * 关闭按钮\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnCloseClick () {\n        AudioManager.instance.playSound(Constant.SOUND.CLICK);\n\n        UIManager.instance.hideDialog(\"debug/debugPanel\");\n\n        GameManager.isGamePause = false;\n    }\n\n    /**\n     * 清除玩家缓存\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnClearStorageClick () {\n        AudioManager.instance.playSound(Constant.SOUND.CLICK);\n\n        PlayerData.instance.playerInfo = {};\n        PlayerData.instance.history = {};\n        PlayerData.instance.settings = {};\n        PlayerData.instance.saveAll();\n\n        StorageManager.instance.jsonData = {};\n        StorageManager.instance.save();\n        UIManager.instance.showTips(\"游戏缓存已清除，请完全关闭游戏并重新打开！\");\n    }\n\n    /**\n     * 切换30帧\n     *\n     * @memberof DebugPanel\n     */\n    public onToggleFrame30Click () {\n        AudioManager.instance.playSound(Constant.SOUND.CLICK);\n\n        UIManager.instance.showTips(\"游戏已经切换为30帧\");\n        StorageManager.instance.setGlobalData(\"frameRate\", 30);\n        game.frameRate = 30;\n        PhysicsSystem.instance.fixedTimeStep = 1 / 30;\n        \n        this._showState();\n    }\n\n    /**\n     * 切换60帧\n     *\n     * @memberof DebugPanel\n     */\n    public onToggleFrame60Click () {\n        AudioManager.instance.playSound(Constant.SOUND.CLICK);\n\n        UIManager.instance.showTips(\"游戏已经切换为60帧\");\n        StorageManager.instance.setGlobalData(\"frameRate\", 60);\n        game.frameRate = 60;\n        PhysicsSystem.instance.fixedTimeStep = 1 / 60;\n\n        this._showState();\n    }\n\n    /**\n     * 清除玩家全部技能\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnClearPlayerSkillClick () {\n        AudioManager.instance.playSound(Constant.SOUND.CLICK);\n\n        PlayerData.instance.playerInfo.arrSkill = [];\n        PlayerData.instance.savePlayerInfoToLocalCache();\n        ClientEvent.dispatchEvent(Constant.EVENT_TYPE.PARSE_PLAYER_SKILL);\n        this._initSkillView();\n    }\n\n    /**\n     *  拥有玩家全部技能\n     *\n     * @memberof DebugPanel\n     */\n    public onBtnSelectAllPlayerSkillClick () {\n        AudioManager.instance.playSound(Constant.SOUND.GET_SKILL);\n\n        let arrSkill = LocalConfig.instance.getTableArr(\"playerSkill\");\n        let arr: any = [];\n        arrSkill.forEach((item: any) => {\n            //生命回复改成在游戏内获得，不通过技能列表获得\n            if (item.ID !== Constant.PLAYER_SKILL.RECOVERY) {\n                arr.push(item.ID);\n            }\n        });\n\n        PlayerData.instance.playerInfo.arrSkill = arr;\n        PlayerData.instance.savePlayerInfoToLocalCache();\n        ClientEvent.dispatchEvent(Constant.EVENT_TYPE.PARSE_PLAYER_SKILL);\n        this._initSkillView();\n\n        EffectManager.instance.loadAndPlayEffect(true, GameManager.ndPlayer, \"levelUp/levelUp\", 1, null, null, false, true, GameManager.gameSpeed, true);\n    }\n\n    /**\n     * 切换调试状态\n     *\n     * @private\n     * @memberof DebugPanel\n     */\n    private _showState () {\n        let isDebugOpen = StorageManager.instance.getGlobalData(\"debug\") ?? false;\n        isDebugOpen ? profiler.showStats() : profiler.hideStats();\n    }\n}"]}