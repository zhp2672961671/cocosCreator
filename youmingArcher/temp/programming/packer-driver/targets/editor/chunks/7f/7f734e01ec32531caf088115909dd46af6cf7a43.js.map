{"version":3,"sources":["file:///E:/myCocosGame/youmingArcher/assets/script/fight/player.ts"],"names":["_decorator","Component","Quat","Vec3","macro","RigidBodyComponent","CapsuleColliderComponent","MapManager","Util","AudioManager","EffectManager","PlayerData","LocalConfig","PlayerModel","ClientEvent","Constant","GameManager","ResourceUtil","Arrow","UIManager","CharacterRigid","PoolManager","qt_0","v3_0","ccclass","property","Player","scriptBloodBar","isMoving","isPlayRotate","scriptCharacterRigid","playerBaseInfo","isArrowDouble","isArrowPenetrate","isArrowContinuous","isArrowIce","isArrowFire","isBloodthirsty","isArrowLightning","isArrowLaunch","curAttackPower","curDefensePower","curAttackSpeed","curDodgeRate","curCriticalHitRate","curCriticalHitDamage","curHpLimit","_arrFormChangeSkill","_arrValueChangeSkill","_arrBuffSkill","_arrTriggerSkill","_hp","_isDie","_horizontal","_vertical","_targetAngle","_curAngleY","_ndTarget","_throwArrowSpeed","_arrowPos","_bloodTipOffsetPos","_playerMonsterOffset","_oriPlayerPos","_oriPlayerScale","_oriPlayerAngle","_curAngle_1","_curAngle_2","_rotateDirection","_ndRunSmokeEffect","_originAngle","_tempAngle","_forWard","_range","_curMoveSpeed","_curBlood","_rotateInterval","_arrArrowPreload","isDie","v","_showDie","curMoveSpeed","initSpeed","onEnable","on","EVENT_TYPE","PARSE_PLAYER_SKILL","_parsePlayerSkill","ON_REVIVE","_onRevive","onDisable","off","curBlood","node","destroy","start","init","getComponent","instance","queryByID","BASE","PLAYER_01","arrScale","parseStringData","scale","set","setScale","resetPlayerWorPos","arrAngle","angle","eulerAngles","attackPower","defensePower","attackSpeed","moveSpeed","dodgeRate","criticalHitRate","criticalHitDamage","hp","console","log","showPlayerBloodBar","scriptPlayerModel","playAni","PLAYER_ANI_TYPE","IDLE","rigidComPlayer","clearState","resetPlayerState","active","children","forEach","ndChild","name","arrPosition","position","isMapAnS","setPosition","isCoverSkill","arrSkill","playerInfo","arrFormChangeSkill","arrValueChangeSkill","arrBuffSkill","arrTriggerSkill","length","item","startsWith","PLAYER_SKILL_USE","FORM_CHANGE","push","VALUE","BUFF","TRIGGER","indexOf","PLAYER_SKILL","ARROW_DOUBLE","ARROW_PENETRATE","ARROW_CONTINUOUS","oriAttackPower","raiseAttackPowerRate_1","getValueSkillRate","RAISE_ATTACK_01","raiseAttackPowerRate_2","RAISE_ATTACK_02","oriDodgeRate","raiseDodgeRate","RAISE_DODGE","oriAttackSpeed","raiseAttackSpeedRate_1","RAISE_ATTACK_SPEED_01","raiseAttackSpeedRate_2","RAISE_ATTACK_SPEED_02","oriHpLimit","raiseHpLimitRate","RAISE_HP_LIMIT","offsetHp","addBlood","oriMoveSpeed","raiseMoveSpeedRate","MOVE_SPEED","oriCriticalHitRate","oriCriticalHitDamage","arrCritical_1","arrCritical_2","getValueSkillRateArr","RAISE_CRITICAL_HIT_DAMAGE_01","RAISE_CRITICAL_HIT_DAMAGE_02","raiseCriticalHitRate","raiseCriticalHitDamage","ARROW_ICE","ARROW_FIRE","ARROW_LIGHTNING","ARROW_LAUNCH","BLOODTHIRSTY","key","rate","skillInfo","Number","value","arrRate","split","map","playAction","obj","action","PLAYER_ACTION","MOVE","radian","RAD","Math","round","cos","sin","STOP_MOVE","_onPlayerStopMove","stopMove","isGameOver","isGameStart","arrMonster","isMonsterSurvive","some","parent","_attackMonster","_moveToTargetWorPos","targetWorPos","angleY","_getTwoPosAngleY","worldPosition","MONSTER_ACTION","selfWorPos","targetScreenPos","mainCamera","worldToScreen","selfScreenPos","subtract","atan2","y","x","PI","getNearestMonster","ATTACK","isRunning","throwArrowToEnemy","forward","normalize","negative","_initArrow","String","ARROW_REVERSE","ARROW_SIDE","ARROW_UMBRELLA","resName","arrowName","loadModelRes","then","prefab","ndArrow","getNode","ndGameManager","playerWorPos","z","setWorldPosition","ndArrowItem","scriptArrowItem","isHasIce","scriptPlayer","isHasFire","isHasLightning","playSound","SOUND","ICE","FIRE","LIGHTNING","LOOSE","bloodNum","isIncreaseLimit","loadAndPlayEffect","gameSpeed","showBloodTips","FIGHT_TIP","ADD_BLOOD","refreshBlood","RECOVERY","reduceBlood","baseInfo","HIT_PLAYER","random","tipType","REDUCE_BLOOD","damage","attackAddition","isCriticalHit","CRITICAL_HIT","playRunSmoke","loadEffectRes","pf","playParticle","hideRunSmoke","preloadArrow","callback","arrPromise","loadArrow","arrowItemNum","Promise","resolve","reject","groupNum","p1","preloadArrowEffects","p2","all","p","PLAYER_01_DIE","DIE","isWin","isGamePause","REVIVE","dispatchEvent","MONSTER_MOVE","update","deltaTime","isEqual","equals","lerp","fromViewUp","toEuler","abs","move","RUN","isIdle","isAttacking"],"mappings":"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","sourcesContent":["import { MapManager } from './mapManager';\nimport { Util } from './../framework/util';\nimport { AudioManager } from './../framework/audioManager';\nimport { EffectManager } from './../framework/effectManager';\nimport { PlayerData } from './../framework/playerData';\nimport { LocalConfig } from './../framework/localConfig';\nimport { PlayerModel } from './playerModel';\nimport { ClientEvent } from './../framework/clientEvent';\nimport { _decorator, Component, Quat, Vec3, Node, macro, RigidBodyComponent, CapsuleColliderComponent, Prefab} from 'cc';\nimport { Constant } from '../framework/constant';\nimport { GameManager } from './gameManager';\nimport { ResourceUtil } from '../framework/resourceUtil';\nimport { Arrow } from './arrow';\nimport { UIManager } from '../framework/uiManager';\nimport { PlayerBloodBar } from '../ui/fight/playerBloodBar';\nimport { CharacterRigid } from './characterRigid';\nimport { PoolManager } from '../framework/poolManager';\n//玩家脚本\nlet qt_0 = new Quat();\nlet v3_0 = new Vec3();\n\nconst { ccclass, property } = _decorator;\n@ccclass('Player')\nexport class Player extends Component {\n    @property(PlayerModel)\n    public scriptPlayerModel: PlayerModel = null!;//玩家动画组件播放脚本\n\n    @property(RigidBodyComponent)\n    public rigidComPlayer: RigidBodyComponent = null!;\n\n    @property(CapsuleColliderComponent)\n    public colliderComPlayer: CapsuleColliderComponent = null!;\n    \n    public scriptBloodBar: PlayerBloodBar = null!;//血条绑定脚本\n    public isMoving: boolean = false;//玩家是否正在移动\n    public isPlayRotate: boolean = false;//是否旋转\n    public scriptCharacterRigid: CharacterRigid = null!;\n    public playerBaseInfo: any = {};//玩家在base.csv的基础数据\n\n    public set isDie (v: boolean) {\n        this._isDie = v;\n\n        if (this._isDie) {\n            this._showDie();\n        }\n    }\n\n    public get isDie () {\n        return this._isDie;\n    }\n\n    //是否拥有形态技能\n    public isArrowDouble: boolean = false;//是否拥有技能：弓箭双重射击\n    public isArrowPenetrate: boolean = false;//是否拥有技能：弓箭穿透射击\n    public isArrowContinuous: boolean = false;//是否拥有技能：连续射击\n\n    //是否拥有buff技能\n    public isArrowIce: boolean = false;//是否拥有技能：冰冻\n    public isArrowFire: boolean = false;//是否拥有技能：灼烧\n\n    //是否拥有触发技能\n    public isBloodthirsty: boolean = false;//是否拥有技能：嗜血\n    public isArrowLightning: boolean = false;//是否拥有技能： 闪电\n    public isArrowLaunch: boolean = false;//是否拥有技能：弹射\n\n    //当前\"数值技能\"值\n    public curAttackPower: number = 20;//当前攻击力\n    public curDefensePower: number = 1;//当前防御力\n    public curAttackSpeed: number = 1;//当前攻击速度\n    public curDodgeRate: number = 0;//当前闪避率\n    public curCriticalHitRate: number = 0;//当前暴击率，0为不暴击\n    public curCriticalHitDamage: number = 0;//当前暴击伤害\n    public curHpLimit: number = 0;//当前玩家生命值上限（这个是上限，是生命上限，不是当前生命值）\n    public set curMoveSpeed (v: number) {\n        this._curMoveSpeed = v;\n        this.scriptCharacterRigid.initSpeed(v);\n    }\n\n    public get curMoveSpeed () {\n        return this._curMoveSpeed;\n    }\n\n    //技能数组\n    private _arrFormChangeSkill: string[] = [];//玩家当前拥有的形态变化技能10x\n    private _arrValueChangeSkill: string[] = [];//玩家数值变化技能20x\n    private _arrBuffSkill: string[] = [];//玩家buff技能30x\n    private _arrTriggerSkill: string[] = [];//玩家触发技能40x\n\n    private _hp: number = 0;//玩家当前生命值\n    private _isDie: boolean = false;//主角是否阵亡\n    private _horizontal: number = 0;//水平移动距离\n    private _vertical: number = 0;//垂直移动距离\n    private _targetAngle: Vec3 = new Vec3();//目标旋转角度\n    private _curAngleY: number = 0;//当前Y分量旋转角度\n    private _ndTarget: Node = null!;//目标小怪\n    private _throwArrowSpeed: number = 30;//弓箭速30\n    private _arrowPos: Vec3 = new Vec3();//箭初始化位置\n    private _bloodTipOffsetPos: Vec3 = new Vec3(-10, 150, 0);//血量提示和玩家间距\n    private _playerMonsterOffset: Vec3 = new Vec3();//小怪和玩家间距\n    private _oriPlayerPos: Vec3 = new Vec3(0, 1.7, 0);//玩家初始世界坐标\n    private _oriPlayerScale: Vec3 = new Vec3(4, 4, 4);//玩家初始缩放倍数\n    private _oriPlayerAngle: Vec3 = new Vec3(0, -90, 0);//玩家初始角度\n    private _curAngle_1: Vec3 = new Vec3()//当前玩家旋转的角度\n    private _curAngle_2: Vec3 = new Vec3();//玩家角度\n    private _rotateDirection: Vec3 = new Vec3();//旋转方向\n    private _ndRunSmokeEffect: Node = null!;//烟雾特效\n    private _originAngle: Vec3 = new Vec3(0, -90, 0);//玩家开始角度\n    private _tempAngle: Vec3 = new Vec3();//临时变量，玩家角度\n    private _forWard: Vec3 = new Vec3();//朝向\n    private _range: number = 0.01;//\n    private _curMoveSpeed: number = 0;//当前玩家移动速度\n    private _curBlood: number = 0;//当前血量\n    private _rotateInterval: number = 0.3;//检查停止移动后是否还在旋转\n    private _arrArrowPreload: string[] = [];\n\n    onEnable () {\n        ClientEvent.on(Constant.EVENT_TYPE.PARSE_PLAYER_SKILL, this._parsePlayerSkill, this);\n        ClientEvent.on(Constant.EVENT_TYPE.ON_REVIVE, this._onRevive, this);\n    }\n\n    onDisable () {\n        ClientEvent.off(Constant.EVENT_TYPE.PARSE_PLAYER_SKILL, this._parsePlayerSkill, this);\n        ClientEvent.off(Constant.EVENT_TYPE.ON_REVIVE, this._onRevive, this);\n\n        if (this.scriptBloodBar) {\n            this._curBlood = this.scriptBloodBar.curBlood;\n            this.scriptBloodBar.node.destroy();\n            this.scriptBloodBar = null!;\n        }\n    }\n\n    start () {\n\n    }\n\n    public init() {\n        this.isMoving = false;\n        this.isDie = false;\n        this.isPlayRotate = false;\n\n        this.isArrowDouble = false;\n        this.isArrowPenetrate = false;\n        this.isArrowContinuous = false;\n        this.isArrowIce = false;\n        this.isArrowFire = false;\n        this.isBloodthirsty = false;\n        this.isArrowLightning = false;\n        this.isArrowLaunch = false;\n\n        this._horizontal = 0;\n        this._vertical = 0;\n\n        this._curBlood = 0;\n        this._ndTarget = null!;\n\n        this.scriptCharacterRigid = this.node.getComponent(CharacterRigid) as CharacterRigid;\n\n        //获取玩家基础数据\n        this.playerBaseInfo = LocalConfig.instance.queryByID(\"base\", Constant.BASE.PLAYER_01);\n        \n        if (this.playerBaseInfo) {\n            //设置玩家大小\n            let arrScale = Util.parseStringData(this.playerBaseInfo.scale, \",\");\n            this._oriPlayerScale.set(arrScale[0], arrScale[1], arrScale[2]);\n            this.node.setScale(this._oriPlayerScale);\n\n            this.resetPlayerWorPos();\n\n            //设置角度\n            let arrAngle = Util.parseStringData(this.playerBaseInfo.angle, \",\");\n            this._oriPlayerAngle.set(arrAngle[0], arrAngle[1], arrAngle[2]);\n            this.node.eulerAngles = this._oriPlayerAngle;\n\n            this.curAttackPower = this.playerBaseInfo.attackPower;\n            this.curDefensePower = this.playerBaseInfo.defensePower;\n            this.curAttackSpeed = this.playerBaseInfo.attackSpeed;\n            this.curMoveSpeed = this.playerBaseInfo.moveSpeed;\n            this.curDodgeRate = this.playerBaseInfo.dodgeRate;\n            this.curCriticalHitRate = this.playerBaseInfo.criticalHitRate;\n            this.curCriticalHitDamage = this.playerBaseInfo.criticalHitDamage;\n            this.curHpLimit = this.playerBaseInfo.hp;\n\n            this._hp = this.playerBaseInfo.hp;\n        }\n\n        this._parsePlayerSkill(true);\n\n        console.log(\"###加载血条1\");\n        //展示血条\n        UIManager.instance.showPlayerBloodBar(this, this._hp, this._hp, ()=>{\n            // if (GameManager.isTesting) {\n            //     this.addBlood(2000, true);\n            // }\n        }, this._bloodTipOffsetPos);\n\n        this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n\n        this.scriptPlayerModel.init();\n\n        this.rigidComPlayer.clearState();\n    }\n\n    /**\n     * 每次成功进入新的一层则更新玩家状态\n     *\n     * @memberof Player\n     */\n    public resetPlayerState () {\n        this.node.active = true;\n        this.rigidComPlayer.clearState();\n        this.resetPlayerWorPos();\n        this.node.eulerAngles = this._originAngle;\n        this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n        //将未播放结束的特效节点隐藏，避免到下一层还在展示特效\n        this.node.children.forEach((ndChild: Node)=>{\n            if (ndChild.name !== \"body\") {\n                ndChild.active = false;\n            }\n        })\n\n        if (!this.scriptBloodBar) {\n            UIManager.instance.showPlayerBloodBar(this, this.curHpLimit, this._curBlood, ()=>{\n            }, this._bloodTipOffsetPos);\n        }\n    }\n\n    /**\n     * 根据an、anS两张图设置不同的玩家初始位置\n     */\n    private resetPlayerWorPos () {\n        let arrPosition = Util.parseStringData(this.playerBaseInfo.position, \",\");\n\n        if (MapManager.isMapAnS) {\n            this._oriPlayerPos.set(-16.742, arrPosition[1], -0.719);\n        } else {\n            //设置坐标\n            this._oriPlayerPos.set(arrPosition[0], arrPosition[1], arrPosition[2]);            \n        }\n\n        this.node.setPosition(this._oriPlayerPos);\n    }\n\n    /**\n     * 解析玩家当前技能\n     * \n     * @param {boolean} isCoverSkill 是否重新覆盖技能，主角初始化的要，其他时候不需要\n     * @memberof Player\n     */\n    private _parsePlayerSkill (isCoverSkill: boolean = false) {\n        let arrSkill = PlayerData.instance.playerInfo.arrSkill;\n\n        let arrFormChangeSkill: string[] = [];\n        let arrValueChangeSkill: string[] = [];\n        let arrBuffSkill: string[] = [];\n        let arrTriggerSkill: string[] = [];\n\n        if (arrSkill.length) {\n            arrSkill.forEach((item: string) => {\n                if (item.startsWith(Constant.PLAYER_SKILL_USE.FORM_CHANGE)) {\n                    arrFormChangeSkill.push(item);\n                } else if (item.startsWith(Constant.PLAYER_SKILL_USE.VALUE)) {\n                    arrValueChangeSkill.push(item);\n                } else if (item.startsWith(Constant.PLAYER_SKILL_USE.BUFF)) {\n                    arrBuffSkill.push(item);\n                } else if (item.startsWith(Constant.PLAYER_SKILL_USE.TRIGGER)) {\n                    arrTriggerSkill.push(item);\n                }\n            });\n        }\n\n        this._arrFormChangeSkill = arrFormChangeSkill;\n        this._arrValueChangeSkill = arrValueChangeSkill;\n        this._arrBuffSkill = arrBuffSkill;\n        this._arrTriggerSkill = arrTriggerSkill;\n\n        // console.log(\"###_arrFormChangeSkill\", this._arrFormChangeSkill);\n        // console.log(\"###_arrValueChangeSkill\", this._arrValueChangeSkill);\n        // console.log(\"###_arrBuffSkill\", this._arrBuffSkill);\n        // console.log(\"###_arrTriggerSkill\", this._arrTriggerSkill);\n\n        if (this._arrFormChangeSkill.length) {\n            this.isArrowDouble = this._arrFormChangeSkill.indexOf(Constant.PLAYER_SKILL.ARROW_DOUBLE) !== -1;\n            this.isArrowPenetrate = this._arrFormChangeSkill.indexOf(Constant.PLAYER_SKILL.ARROW_PENETRATE) !== -1;\n            this.isArrowContinuous = this._arrFormChangeSkill.indexOf(Constant.PLAYER_SKILL.ARROW_CONTINUOUS) !== -1;\n        } else {\n            this.isArrowDouble = false;\n            this.isArrowPenetrate = false;\n            this.isArrowContinuous = false;\n        }\n\n        //数值技能只使用一次, 注意：每次获得到需用乘法都是用当前值去乘，而不是乘以最开始的值\n        if (this._arrValueChangeSkill.length) {\n            //攻击力提升百分比\n            let oriAttackPower = this.playerBaseInfo.attackPower;\n            let curAttackPower = oriAttackPower;\n            //攻击力1\n            let raiseAttackPowerRate_1 = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_ATTACK_01);\n            curAttackPower = oriAttackPower * (1 + raiseAttackPowerRate_1);\n            //攻击力2\n            let raiseAttackPowerRate_2 = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_ATTACK_02);\n            this.curAttackPower = curAttackPower * (1 + raiseAttackPowerRate_2);\n            \n            //闪避率提升百分比\n            let oriDodgeRate = this.playerBaseInfo.dodgeRate;\n            let raiseDodgeRate = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_DODGE);\n            this.curDodgeRate = oriDodgeRate + raiseDodgeRate;//注：以加法形式增加\n\n            //攻速提升百分比\n            let oriAttackSpeed = this.playerBaseInfo.attackSpeed;\n            let curAttackSpeed = oriAttackSpeed;\n            //攻速1\n            let raiseAttackSpeedRate_1 = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_ATTACK_SPEED_01);\n            curAttackSpeed = oriAttackSpeed * (1 + raiseAttackSpeedRate_1);\n            //攻速2\n            let raiseAttackSpeedRate_2 = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_ATTACK_SPEED_02);\n            this.curAttackSpeed = curAttackSpeed * (1 + raiseAttackSpeedRate_2);\n\n            if (!isCoverSkill) {\n                let oriHpLimit = this.playerBaseInfo.hp;\n                let raiseHpLimitRate = this.getValueSkillRate(Constant.PLAYER_SKILL.RAISE_HP_LIMIT);\n                let offsetHp = oriHpLimit * raiseHpLimitRate;\n                let curHpLimit = oriHpLimit + offsetHp;\n\n                if (curHpLimit > this.curHpLimit) {\n                    this.addBlood(offsetHp, true);\n                    this.curHpLimit = curHpLimit;\n                    this._hp += offsetHp;\n                }\n            }\n\n            //移速提升百分比\n            let oriMoveSpeed = this.playerBaseInfo.moveSpeed;\n            let raiseMoveSpeedRate = this.getValueSkillRate(Constant.PLAYER_SKILL.MOVE_SPEED);\n            this.curMoveSpeed = oriMoveSpeed * (1 + raiseMoveSpeedRate);\n\n            //暴击+爆伤提升百分比\n            let oriCriticalHitRate = this.playerBaseInfo.criticalHitRate;\n            let oriCriticalHitDamage = this.playerBaseInfo.criticalHitDamage;\n            let arrCritical_1: any = [0, 0];//暴击率,暴击伤害比\n            let arrCritical_2: any = [0, 0];//暴击率,暴击伤害比\n            arrCritical_1 = this.getValueSkillRateArr(Constant.PLAYER_SKILL.RAISE_CRITICAL_HIT_DAMAGE_01);\n            arrCritical_2 = this.getValueSkillRateArr(Constant.PLAYER_SKILL.RAISE_CRITICAL_HIT_DAMAGE_02);\n\n            let raiseCriticalHitRate = arrCritical_1[0] + arrCritical_2[0];\n            let raiseCriticalHitDamage = arrCritical_1[1] + arrCritical_2[1];\n\n            if (raiseCriticalHitRate) {\n                this.curCriticalHitRate = oriCriticalHitRate + raiseCriticalHitRate;//注：以加法形式增加\n            }\n            \n            if (raiseCriticalHitDamage) {\n                this.curCriticalHitDamage = oriCriticalHitDamage + raiseCriticalHitDamage;//注：以加法形式增加\n            }\n        } else {\n            this.curAttackPower = this.playerBaseInfo.attackPower;\n            this.curAttackSpeed = this.playerBaseInfo.attackSpeed;\n            this.curMoveSpeed = this.playerBaseInfo.moveSpeed;\n            this.curDodgeRate = this.playerBaseInfo.dodgeRate;\n            this.curCriticalHitRate = this.playerBaseInfo.criticalHitRate;\n            this.curCriticalHitDamage = this.playerBaseInfo.criticalHitDamage;\n            this.curHpLimit = this.playerBaseInfo.hp;\n        }\n\n        if (this._arrBuffSkill.length) {\n            this.isArrowIce = this._arrBuffSkill.indexOf(Constant.PLAYER_SKILL.ARROW_ICE) !== -1;\n            this.isArrowFire = this._arrBuffSkill.indexOf(Constant.PLAYER_SKILL.ARROW_FIRE) !== -1;\n        } else {\n            this.isArrowIce = false;\n            this.isArrowFire = false;\n        }\n\n        if (this._arrTriggerSkill.length) {\n            this.isArrowLightning = this._arrTriggerSkill.indexOf(Constant.PLAYER_SKILL.ARROW_LIGHTNING) !== -1;\n            this.isArrowLaunch = this._arrTriggerSkill.indexOf(Constant.PLAYER_SKILL.ARROW_LAUNCH) !== -1;\n            this.isBloodthirsty = this._arrTriggerSkill.indexOf(Constant.PLAYER_SKILL.BLOODTHIRSTY) !== -1;\n        } else {\n            this.isArrowLightning = false;  \n            this.isArrowLaunch = false;\n            this.isBloodthirsty = false;\n        }\n    }\n\n    /**\n     * 返回当前数值技能提升比例\n     */\n    private getValueSkillRate (key: string) {\n        let rate = 0;//百分比\n\n        if (this._arrValueChangeSkill.indexOf(key) !== -1) {\n            let skillInfo = LocalConfig.instance.queryByID(\"playerSkill\", key);\n            rate = Number(skillInfo.value);\n        }\n\n        return rate ?? 0;\n    }\n\n    /**\n     * 返回当前数值技能提升比例数组\n     */\n     private getValueSkillRateArr (key: string) {\n        let arrRate: any[] = [];\n\n        if (this._arrValueChangeSkill.indexOf(key) !== -1) {\n            let skillInfo = LocalConfig.instance.queryByID(\"playerSkill\", key);\n            arrRate = skillInfo.value.split(\"#\");\n        }\n\n        arrRate = arrRate.map((item: number)=>{\n            return item ? Number(item) : 0;\n        })\n\n        if (arrRate.length === 0) {\n            arrRate = [0, 0];\n        }\n\n        return arrRate;\n    }\n\n    /**\n     * 玩家行为\n     *\n     * @param {*} obj\n     * @memberof Player\n     */\n    public playAction (obj: any) {\n        if (this.isDie) {\n            return;\n        }\n\n        switch (obj.action) {\n            case Constant.PLAYER_ACTION.MOVE:\n                let angle = obj.value + 135;\n                let radian = angle * macro.RAD;\n                this._horizontal = Math.round(Math.cos(radian) * 1);\n                this._vertical = Math.round(Math.sin(radian) * 1);  \n                this.isMoving = true;\n                this._curAngleY = obj.value;\n                this._curAngleY = this._curAngleY < 0 ? this._curAngleY + 360 : this._curAngleY > 360 ? this._curAngleY - 360 : this._curAngleY;\n                break;\n            case Constant.PLAYER_ACTION.STOP_MOVE:\n                this._horizontal = 0;\n                this._vertical = 0;\n                this._onPlayerStopMove();\n                this.isMoving = false;\n                this.rigidComPlayer.clearState();\n                this.scriptCharacterRigid.stopMove();\n                this._rotateInterval = 0.2;\n                break;\n            default:\n                break;\n        }\n    }\n\n    /**\n     * 玩家不移动时：a) 地图上没有怪物：在原地待机。b) 地图上有怪物：向怪物方向攻击。\n     *\n     * @private\n     * @memberof Player\n     */\n    private _onPlayerStopMove () {\n        if (!GameManager.isGameOver && GameManager.isGameStart) {\n            if (GameManager.arrMonster.length) {\n                let isMonsterSurvive = GameManager.arrMonster.some((item: Node)=>{\n                    return item.parent !== null; \n                })\n                \n                if (isMonsterSurvive) {\n                    this._attackMonster();\n                }\n            } else {\n                this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n            }\n        }\n    }\n\n    /**\n     * 向目标位置移动\n     *\n     * @private\n     * @memberof Monster\n     */\n    private _moveToTargetWorPos (targetWorPos: Vec3) {\n        let angleY = this._getTwoPosAngleY(this.node.worldPosition, targetWorPos);\n        this.playAction({action: Constant.MONSTER_ACTION.MOVE, value: angleY});\n    }\n\n    private _getTwoPosAngleY (selfWorPos: Vec3, targetWorPos: Vec3) {\n        let targetScreenPos =  GameManager.mainCamera?.worldToScreen(targetWorPos) as Vec3;\n        let selfScreenPos = GameManager.mainCamera?.worldToScreen(selfWorPos) as Vec3;\n        Vec3.subtract(this._playerMonsterOffset, targetScreenPos, selfScreenPos);\n        let angleY = Math.round(Math.atan2(this._playerMonsterOffset.y, this._playerMonsterOffset.x) * 180 / Math.PI);\n        return angleY;\n    }\n\n    /**\n     * 向怪物方向攻击\n     */\n    private _attackMonster () {\n        this._ndTarget = GameManager.getNearestMonster()!;\n\n        if (!this._ndTarget || this.isDie) {\n            return;\n        }\n\n        this._moveToTargetWorPos(this._ndTarget.worldPosition);\n\n        this.isMoving = false;\n\n        //播放攻击动画\n        this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.ATTACK, false, ()=>{\n            if (!this.scriptPlayerModel.isRunning) {\n                this._attackMonster();                \n            }\n        });\n    }\n\n    /**\n     * 向敌人射箭\n     *\n     * @returns\n     * @memberof Player\n     */\n    public throwArrowToEnemy () {\n        //射击摇摆\n        this.node.forward = Vec3.subtract(this._forWard, this.node.worldPosition, this._ndTarget.worldPosition).normalize().negative();\n\n        //使用形态变换技能\n        if (this._arrFormChangeSkill.length) {\n            //使用技能\n            if (this.isArrowDouble) {\n                if (this.isArrowContinuous) {\n                    this._initArrow(\"arrowDoubleContinuous\");\n                } else {\n                    this._initArrow(\"arrowDouble\");\n                }\n            } else {\n                if (this.isArrowContinuous) {\n                    this._initArrow(\"arrowSingleContinuous\");\n                } else {\n                    this._initArrow(\"arrowSingle\");\n                }\n            } \n            \n            this._arrFormChangeSkill.forEach((item: string)=>{\n                let skillInfo = LocalConfig.instance.queryByID(\"playerSkill\", String(item));\n\n                if (item === Constant.PLAYER_SKILL.ARROW_REVERSE || item === Constant.PLAYER_SKILL.ARROW_SIDE || item === Constant.PLAYER_SKILL.ARROW_UMBRELLA) {\n                    this._initArrow(skillInfo.resName);\n                }\n            })\n        } else {\n            //没有技能则默认连续射单只箭\n            this._initArrow(\"arrowSingle\");\n        }\n    }\n\n    /**\n     * 初始化箭\n     *\n     * @private\n     * @param {string} arrowName\n     * @memberof Player\n     */\n    private _initArrow (arrowName: string) {\n        ResourceUtil.loadModelRes(`weapon/arrow/${arrowName}`).then((prefab: any)=>{\n            if (this.isMoving) {\n                return;\n            }\n            let ndArrow = PoolManager.instance.getNode(prefab, GameManager.ndGameManager as Node) as Node;\n            let playerWorPos = this.node.worldPosition;\n            this._arrowPos.set(playerWorPos.x, 3, playerWorPos.z);\n\n            // if (GameManager.isTesting) {\n            //     this._arrowPos.set(playerWorPos.x, -3, playerWorPos.z);\n            // }\n            \n            ndArrow.setWorldPosition(this._arrowPos);\n            ndArrow.eulerAngles = this.node.eulerAngles;\n            \n            ndArrow.children.forEach((ndArrowItem: Node)=>{\n                let scriptArrowItem = ndArrowItem.getComponent(Arrow) as Arrow;\n                scriptArrowItem.init(this._throwArrowSpeed, this.node.worldPosition);\n            })\n\n            //播放箭的音效\n            let isHasIce = GameManager.scriptPlayer.isArrowIce;\n            let isHasFire = GameManager.scriptPlayer.isArrowFire;\n            let isHasLightning = GameManager.scriptPlayer.isArrowLightning;\n\n            if (isHasIce || isHasFire || isHasLightning) {\n                if (isHasIce) {\n                    AudioManager.instance.playSound(Constant.SOUND.ICE);  \n                }\n\n                if (isHasFire) {\n                    AudioManager.instance.playSound(Constant.SOUND.FIRE);  \n                }\n\n                if (isHasLightning) {\n                    AudioManager.instance.playSound(Constant.SOUND.LIGHTNING);  \n                }\n            } else {\n                AudioManager.instance.playSound(Constant.SOUND.LOOSE);  \n            }\n        })\n    }\n\n    /**\n     * 玩家加血、增加血量上限\n     *\n     * @param {number} bloodNum\n     * @param {boolean} [isIncreaseLimit]\n     * @memberof Player\n     */\n    public addBlood (bloodNum: number, isIncreaseLimit?: boolean) {\n        EffectManager.instance.loadAndPlayEffect(true, this.node, \"recovery/recovery\", 1, null, null, true, true, GameManager.gameSpeed, true);\n\n        UIManager.instance.showBloodTips(this, Constant.FIGHT_TIP.ADD_BLOOD, bloodNum, this._bloodTipOffsetPos);\n        this.scriptBloodBar.refreshBlood(bloodNum, isIncreaseLimit);\n\n        AudioManager.instance.playSound(Constant.SOUND.RECOVERY);\n    }\n\n    /**\n     * 玩家扣血\n     *\n     * @param {*} baseInfo 敌人基础信息\n     * @return {*} \n     * @memberof Player\n     */\n    public reduceBlood (baseInfo: any) {\n        if (this.isDie) {\n            return;\n        }\n\n        AudioManager.instance.playSound(Constant.SOUND.HIT_PLAYER);  \n        \n        if (Math.random() > this.playerBaseInfo.dodgeRate) {\n            //扣血\n            let tipType = Constant.FIGHT_TIP.REDUCE_BLOOD;\n            //敌人伤害\n            let damage = baseInfo.attackPower * GameManager.attackAddition * (1 - this.playerBaseInfo.defensePower / (this.playerBaseInfo.defensePower + 400));\n            let isCriticalHit = Math.random() <= baseInfo.criticalHitRate;//是否暴击\n            if (isCriticalHit) {\n                damage = damage * baseInfo.criticalHitDamage;\n                tipType = Constant.FIGHT_TIP.CRITICAL_HIT;\n            }\n\n            UIManager.instance.showBloodTips(this, tipType, -damage, this._bloodTipOffsetPos);\n            this.scriptBloodBar.refreshBlood(-damage);\n        }\n    }\n\n    /**\n     * 奔跑的时候加个烟雾\n     *\n     * @memberof Player\n     */\n    public playRunSmoke () {\n        // console.log(\"展示烟雾\");\n\n        if (!this._ndRunSmokeEffect) {\n            ResourceUtil.loadEffectRes(\"runSmoke/runSmoke\").then((pf: any)=>{\n                this._ndRunSmokeEffect = PoolManager.instance.getNode(pf, this.node);\n                this._ndRunSmokeEffect.active = true;    \n                EffectManager.instance.playParticle(this._ndRunSmokeEffect);\n            });\n        } else {\n            this._ndRunSmokeEffect.active = true;\n            EffectManager.instance.playParticle(this._ndRunSmokeEffect);\n        }\n    }\n\n    /**\n     * 攻击的时候隐藏烟雾\n     *\n     * @memberof Player\n     */\n    public hideRunSmoke () {\n        if (this._ndRunSmokeEffect && this._ndRunSmokeEffect.active) {\n            this._ndRunSmokeEffect.active = false;\n            // console.log(\"隐藏烟雾\");\n        }\n    }\n\n    /**\n     * 预加载箭和特效\n     *\n     * @param {Function} callback\n     * @memberof Player\n     */\n    public preloadArrow (callback: Function) {\n        let arrPromise = [];\n\n        let loadArrow = (arrowName: string, arrowItemNum: number) => {\n            return new Promise((resolve, reject)=>{\n                if (this._arrArrowPreload.indexOf(arrowName) == -1) {\n                    console.log(\"是否首次加载箭\", arrowName);\n                    this._arrArrowPreload.push(arrowName);\n                    let groupNum = 2;//加载两三组\n                    let p1 = GameManager.preloadArrowEffects(arrowItemNum * groupNum);\n                    let p2 = GameManager.preloadArrow(arrowName, groupNum);\n                    Promise.all([p1, p2]).then(()=>{\n                        resolve(null);\n                    })\n                } else {\n                    resolve(null);\n                }\n            })\n        }\n\n        //没有技能,默认单只箭\n        if (this._arrFormChangeSkill.length) {\n\n            //使用技能\n            this._arrFormChangeSkill.forEach((item: string)=>{\n                let skillInfo = LocalConfig.instance.queryByID(\"playerSkill\", String(item));\n                if (item === Constant.PLAYER_SKILL.ARROW_REVERSE || item === Constant.PLAYER_SKILL.ARROW_SIDE || item === Constant.PLAYER_SKILL.ARROW_UMBRELLA) {\n                    let p = loadArrow(skillInfo.resName, 2);\n                    arrPromise.push(p);\n                }\n            })\n\n            if (this.isArrowDouble) {\n                if (this.isArrowContinuous) {\n                    let p = loadArrow(\"arrowDoubleContinuous\", 4);\n                    arrPromise.push(p);\n\n                } else {\n                    let p = loadArrow(\"arrowDouble\", 2);\n                    arrPromise.push(p);\n                }\n            } else {\n                if (this.isArrowContinuous) {\n                    let p = loadArrow(\"arrowSingleContinuous\", 2);\n                    arrPromise.push(p);\n                } else {\n                    let p = loadArrow(\"arrowSingle\", 1);\n                    arrPromise.push(p);\n                }\n            } \n        } else {\n            //默认连续射单只箭\n            let p = loadArrow(\"arrowSingle\", 1);\n            arrPromise.push(p);\n        }\n\n        Promise.all(arrPromise).then(()=>{\n            callback && callback();\n        })\n    }\n\n    private _showDie () {\n        this.scriptCharacterRigid.stopMove();\n        AudioManager.instance.playSound(Constant.SOUND.PLAYER_01_DIE);\n\n        this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.DIE, false, ()=>{\n            GameManager.isWin = false;\n        });\n    }\n\n    /**\n     * 玩家复活\n     */\n     private _onRevive () {\n        GameManager.isGamePause = false;\n        this.addBlood(this.curHpLimit * 0.5);\n        this.scriptBloodBar.node.active = true;\n\n        this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.REVIVE, false, ()=>{\n            this.isDie = false;\n            this.playAction({action: Constant.PLAYER_ACTION.STOP_MOVE});\n            ClientEvent.dispatchEvent(Constant.EVENT_TYPE.MONSTER_MOVE);\n        });\n\n        AudioManager.instance.playSound(Constant.SOUND.REVIVE);  \n    }\n\n    update (deltaTime: number) {\n        if (!GameManager.isGameStart || GameManager.isGameOver || GameManager.isGamePause || this.isDie) {\n            return;\n        }\n\n        //玩家旋转\n        if (this.isPlayRotate) {\n            //当前玩家角度\n            this._tempAngle.set(this.node.eulerAngles);\n            this._tempAngle.y = this._tempAngle.y < 0 ? this._tempAngle.y + 360 : this._tempAngle.y;\n\n            this.node.eulerAngles = this._tempAngle;\n\n            this._curAngle_1.set(0, this._tempAngle.y, 0);\n\n            if (this._horizontal === 0 && this._vertical === 0) {\n                this._range = 0.1;\n            } else {\n                this._range = 0.01;\n            }\n\n            //第二个参数越小朝向敌人越精确\n            let isEqual = this._curAngle_1.equals(this._targetAngle, this._range);\n\n            if (!isEqual) {\n                Vec3.lerp(this._curAngle_1, this._curAngle_1, this._targetAngle, 0.167);\n                this.node.eulerAngles = this._curAngle_1;\n            } else {\n                this.isPlayRotate = false;\n                this.node.eulerAngles = this._targetAngle;\n            }\n        }\n\n        if (this._horizontal !== 0 || this._vertical !== 0) {\n            //计算出旋转角度\n            this._rotateDirection.set(this._horizontal, 0, -this._vertical);\n            this._rotateDirection.normalize();\n            Quat.fromViewUp(qt_0, this._rotateDirection);\n            Quat.toEuler(v3_0, qt_0);\n            v3_0.y = v3_0.y < 0 ? v3_0.y + 360 : v3_0.y;\n\n            // console.log(\"v3_0\", v3_0.y);\n\n            this.isPlayRotate = true;\n            \n            //设置当前玩家角度为正数\n            this._curAngle_2.set(this.node.eulerAngles);\n            if (this._curAngle_2.y < 0) {\n                this._curAngle_2.y += 360;\n                this.node.eulerAngles = this._curAngle_2; // 转为0~360\n            } else if (this._curAngle_2.y > 360) {\n                this._curAngle_2.y -= 360;\n                this.node.eulerAngles = this._curAngle_2; // 转为0~360\n            }\n\n            //设置目标旋转角度\n            if (!v3_0.equals(this.node.eulerAngles, 0.01)) {\n                this._targetAngle.y = this._curAngleY + 225; \n                this._targetAngle.y = this._targetAngle.y < 0 ? this._targetAngle.y + 360 : this._targetAngle.y > 360 ? this._targetAngle.y - 360 : this._targetAngle.y;\n                this._targetAngle.set(0, this._targetAngle.y, 0);\n\n                if (Math.abs(this._targetAngle.y - this._curAngle_2.y) > 180) {\n                    if (this._targetAngle.y > this._curAngle_2.y) {\n                        this._targetAngle.y -= 360;\n                    } else {\n                        this._targetAngle.y += 360;\n                    }\n                }\n\n                // console.log(\"this._targetAngle.y\", this._targetAngle.y);\n            } else {\n                this.isPlayRotate = false;\n                this.node.eulerAngles = v3_0;\n            }\n\n            if (!this.isMoving) {\n                return;\n            }\n\n            this.scriptCharacterRigid.move(this._rotateDirection.x * this.curMoveSpeed * 0.5 * deltaTime, this._rotateDirection.z * this.curMoveSpeed * 0.5 * deltaTime);\n\n            if (!this.scriptPlayerModel.isRunning && !this.isDie) {\n                this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.RUN, true);\n            }\n        } else {\n            if (!this.isDie && !this.scriptPlayerModel.isIdle && !this.scriptPlayerModel.isAttacking) {\n                this.scriptPlayerModel.playAni(Constant.PLAYER_ANI_TYPE.IDLE, true);\n                this.scriptCharacterRigid.stopMove();\n            }\n\n            if (this._rotateInterval > 0) {\n                this._rotateInterval  -= deltaTime;\n                if (this._rotateInterval <= 0 && this.isPlayRotate) {\n                    this.isPlayRotate = false;\n                }\n            }\n        }\n    }\n}\n"]}