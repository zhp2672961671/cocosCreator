{"version":3,"sources":["file:///E:/myCocosGame/mySimpleGame/assets/simple-run/scripts/GameManager.ts"],"names":["_decorator","Component","Node","Vec3","Prefab","LabelComponent","NodePool","instantiate","math","AnimationComponent","PlayerController","GameDefines","GameState","ccclass","property","tempVec3_a","GameManager","type","_coinPool","_coinNum","_straitFloorPool","_roadBlockPool","_checkPassedTime","_checkInterval","_activeFloors","_curState","INIT","coinNum","value","coinScoreLabel","string","curState","initPanel","active","playingPanel","endPanel","reset","PLAYING","END","playerCtrl","onGameStateChanged","start","onTriggerCoin","onCoinTriggered","bind","onTriggerBlock","onBlockTriggered","forEach","floorNode","destroyFloor","i","maxActiveFloor","posZ","floorLength","needItem","generateFloor","set","j","children","length","child","name","CoinNodeName","parent","put","BlockNodeName","pos","generateItem","createStraitFloor","push","console","log","generateType","randomRangeInt","createCoin","randomXPos","createRoadBlock","straitFloorNode","size","get","straitFloorPrfb","setPosition","node","localPos","coinNode","coinPrfb","roadBlock","roadBlockPrfb","animComp","getComponent","downName","state","getState","setTime","sample","blockNode","posXPool","leftLineX","middleLineX","rightLineX","index","posX","checkToGenerateElem","deltaTime","backIndex","floor","position","z","first","shift","last","update","onStartButtonClicked","onRestartButtonClicked"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, Prefab, LabelComponent, NodePool, instantiate, math, AnimationComponent } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nimport { PlayerController } from './PlayerController';\r\nimport {GameDefines, GameState } from './GameDefines';\r\nconst tempVec3_a = new Vec3();\r\n\r\n@ccclass('GameManager')\r\nexport class GameManager extends Component {\r\n    @property({type: Prefab})\r\n    public straitFloorPrfb: Prefab = null;\r\n\r\n    @property({type: Prefab})\r\n    public coinPrfb: Prefab = null;\r\n    @property({type: Prefab})\r\n    public roadBlockPrfb: Prefab = null;\r\n\r\n    @property({type: PlayerController})\r\n    public playerCtrl: PlayerController = null;\r\n    @property({type: LabelComponent})\r\n    public coinScoreLabel: LabelComponent = null;\r\n\r\n    @property({type: Node})\r\n    public initPanel: Node = null;\r\n    @property({type: Node})\r\n    public playingPanel: Node = null;\r\n    @property({type: Node})\r\n    public endPanel: Node = null;\r\n    private _coinPool: NodePool = new NodePool();\r\n    private _coinNum: number = 0;\r\n    private _straitFloorPool: NodePool = new NodePool();\r\n    private _roadBlockPool: NodePool = new NodePool();\r\n    private _checkPassedTime: number = 0;\r\n    private _checkInterval: number = 1;\r\n    private _activeFloors: Node[] = [];\r\n    private _curState: GameState = GameState.INIT;\r\n\r\n    get coinNum() {\r\n        return this._coinNum;\r\n    }\r\n\r\n    set coinNum(value: number) {\r\n        this._coinNum = value;\r\n        this.coinScoreLabel.string = ''+value;\r\n    }\r\n\r\n    set curState(value: GameState) {\r\n        switch(value) {\r\n            case GameState.INIT:\r\n                this.initPanel.active = true;\r\n                this.playingPanel.active = false;\r\n                this.endPanel.active = false;\r\n                this.reset();\r\n                break;\r\n            case GameState.PLAYING:\r\n                this.initPanel.active = false;\r\n                this.playingPanel.active = true;\r\n                this.coinNum = 0;\r\n\r\n                break;\r\n            case GameState.END:\r\n                this.playingPanel.active = false;\r\n                this.endPanel.active = true;\r\n                break;\r\n        }\r\n\r\n        this._curState = value;\r\n        this.playerCtrl.onGameStateChanged(value);\r\n    }\r\n\r\n    get curState() {\r\n        return this._curState;\r\n    }\r\n    start () {\r\n        this.curState = GameState.INIT;\r\n        this.playerCtrl.onTriggerCoin = this.onCoinTriggered.bind(this);\r\n        this.playerCtrl.onTriggerBlock = this.onBlockTriggered.bind(this);\r\n    }\r\n    reset() {\r\n        // clear all\r\n        this._activeFloors.forEach((floorNode: Node) => {\r\n            this.destroyFloor(floorNode);\r\n        });\r\n        this._activeFloors = [];\r\n\r\n        // init\r\n        for (let i = 0; i < GameDefines.maxActiveFloor; i++) {\r\n            const posZ = i * GameDefines.floorLength;\r\n            let needItem = false;\r\n            if (i > 1) {\r\n                needItem = true;\r\n            }\r\n\r\n            this.generateFloor(tempVec3_a.set(0, 0, posZ), needItem);\r\n        }\r\n    }\r\n\r\n    // 销毁地面\r\n    destroyFloor(floorNode: Node) {\r\n        for (let j = 0; j < floorNode.children.length; j++) {\r\n            const child = floorNode.children[j];\r\n            // 回收金币1和障碍物\r\n            if (child.name === GameDefines.CoinNodeName) {\r\n                child.parent = null;\r\n                this._coinPool.put(child);\r\n            } else if (child.name === GameDefines.BlockNodeName) {\r\n                child.parent = null;\r\n                this._roadBlockPool.put(child);\r\n            }\r\n\r\n        }\r\n        this._straitFloorPool.put(floorNode);\r\n    }\r\n\r\n    generateFloor(pos: Vec3, generateItem: boolean = false) {\r\n        let floorNode = this.createStraitFloor(pos);\r\n        this._activeFloors.push(floorNode);\r\n        console.log(\"generateFloor============================\")\r\n\r\n        if (generateItem) {\r\n            const generateType = math.randomRangeInt(0, 3);\r\n            if (generateType === 1) {\r\n                this.createCoin(floorNode, tempVec3_a.set(this.randomXPos(), 1, 0));\r\n            } else if (generateType === 2) {\r\n                this.createRoadBlock(floorNode, tempVec3_a.set(this.randomXPos(), 0, 0));\r\n            }\r\n        }\r\n    }\r\n    // 创建地面\r\n    createStraitFloor(pos: Vec3) {\r\n        let straitFloorNode: Node = null;\r\n        if (this._straitFloorPool.size() > 0) {\r\n            straitFloorNode = this._straitFloorPool.get();\r\n        } else {\r\n            straitFloorNode = instantiate(this.straitFloorPrfb);\r\n        }\r\n\r\n        straitFloorNode.setPosition(pos);\r\n        straitFloorNode.parent = this.node;\r\n\r\n        return straitFloorNode;\r\n    }\r\n    // 创建金币\r\n    createCoin(parent: Node, localPos: Vec3) {\r\n        let coinNode: Node = null;\r\n        if (this._coinPool.size() > 0) {\r\n            coinNode = this._coinPool.get();\r\n        } else {\r\n            coinNode = instantiate(this.coinPrfb);\r\n        }\r\n        coinNode.setPosition(localPos);\r\n        coinNode.parent = parent;\r\n\r\n        return coinNode;\r\n    }\r\n    // 创建挡板\r\n    createRoadBlock(parent: Node, localPos: Vec3) {\r\n        let roadBlock: Node = null;\r\n        if (this._roadBlockPool.size() > 0) {\r\n            roadBlock = this._roadBlockPool.get();\r\n        } else {\r\n            roadBlock = instantiate(this.roadBlockPrfb);\r\n        }\r\n\r\n        roadBlock.setPosition(localPos);\r\n        roadBlock.parent = parent;\r\n        // 初始动画\r\n\r\n        const animComp = roadBlock.getComponent(AnimationComponent);\r\n        const downName = 'block_down';\r\n        const state = animComp.getState(downName);\r\n        state.setTime(0);\r\n        state.sample();\r\n\r\n        return roadBlock;\r\n    }\r\n    onCoinTriggered(coinNode: Node) {\r\n        this._coinNum ++;\r\n        this.coinScoreLabel.string = '' + this._coinNum;\r\n        this._coinPool.put(coinNode);\r\n    }\r\n\r\n    onBlockTriggered(blockNode: Node) {\r\n        this.curState = GameState.END;\r\n    }\r\n\r\n    // 获取随机位置\r\n    randomXPos() {\r\n        const posXPool: number[] = [GameDefines.leftLineX, GameDefines.middleLineX, GameDefines.rightLineX];\r\n        const index = math.randomRangeInt(0, 3);\r\n        const posX: number = posXPool[index];\r\n\r\n        return posX;\r\n    }\r\n    checkToGenerateElem(deltaTime: number) {\r\n        this._checkPassedTime += deltaTime;\r\n        if (this._checkPassedTime > this._checkInterval) {\r\n            // 隐藏在人物身后的Floor\r\n            let backIndex = 0;\r\n            for (let i = 0; i < this._activeFloors.length; i++) {\r\n                const floor = this._activeFloors[i];\r\n                if (floor.position.z > (this.playerCtrl.node.position.z - GameDefines.floorLength)) {\r\n                    backIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (backIndex > 0) {\r\n                for (let i = 0; i < backIndex; i++) {\r\n                    const first: Node = this._activeFloors.shift();\r\n                    this.destroyFloor(first);\r\n                    const last = this._activeFloors[this._activeFloors.length - 1];\r\n                    const posZ = last.position.z + GameDefines.floorLength;\r\n                    this.generateFloor(tempVec3_a.set(0, 0, posZ), true);\r\n                }\r\n            }\r\n\r\n            this._checkPassedTime = 0;\r\n        }\r\n    }\r\n\r\n\r\n\r\n\r\n    update(deltaTime: number) {\r\n        this.checkToGenerateElem(deltaTime);\r\n    }\r\n     // 游戏开始按钮\r\n    onStartButtonClicked() {\r\n        this.curState = GameState.PLAYING;\r\n    }\r\n  // 游戏重新开始按钮\r\n    onRestartButtonClicked() {\r\n        this.curState = GameState.INIT;\r\n    }\r\n}\r\n\r\n\r\n"]}